!function(e){function t(t){for(var n,o,a=t[0],i=t[1],s=0,u=[];s<a.length;s++)o=a[s],r[o]&&u.push(r[o][0]),r[o]=0;for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n]);for(l&&l(t);u.length;)u.shift()()}var n={},r={0:0};var o={};var a={5:function(){return{"./web_menorah":{__wbindgen_throw:function(e,t){return n[4].exports.__wbindgen_throw(e,t)}}}}};function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.e=function(e){var t=[],n=r[e];if(0!==n)if(n)t.push(n[2]);else{var s=new Promise(function(t,o){n=r[e]=[t,o]});t.push(n[2]=s);var u,c=document.getElementsByTagName("head")[0],l=document.createElement("script");l.charset="utf-8",l.timeout=120,i.nc&&l.setAttribute("nonce",i.nc),l.src=function(e){return i.p+""+({}[e]||e)+".bundle.js"}(e),u=function(t){l.onerror=l.onload=null,clearTimeout(f);var n=r[e];if(0!==n){if(n){var o=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src,i=new Error("Loading chunk "+e+" failed.\n("+o+": "+a+")");i.type=o,i.request=a,n[1](i)}r[e]=void 0}};var f=setTimeout(function(){u({type:"timeout",target:l})},12e4);l.onerror=l.onload=u,c.appendChild(l)}return({1:[5]}[e]||[]).forEach(function(e){var n=o[e];if(n)t.push(n);else{var r,s=a[e](),u=fetch(i.p+""+{5:"e8e1befaf85738b292de"}[e]+".module.wasm");if(s instanceof Promise&&"function"==typeof WebAssembly.compileStreaming)r=Promise.all([WebAssembly.compileStreaming(u),s]).then(function(e){return WebAssembly.instantiate(e[0],e[1])});else if("function"==typeof WebAssembly.instantiateStreaming)r=WebAssembly.instantiateStreaming(u,s);else{r=u.then(function(e){return e.arrayBuffer()}).then(function(e){return WebAssembly.instantiate(e,s)})}t.push(o[e]=r.then(function(t){return i.w[e]=(t.instance||t).exports}))}}),Promise.all(t)},i.m=e,i.c=n,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i.oe=function(e){throw console.error(e),e},i.w={};var s=window.webpackJsonp=window.webpackJsonp||[],u=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var l=u;i(i.s=3)}({3:function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"create",function(){return f}),n.d(r,"clone",function(){return E}),n.d(r,"copy",function(){return d}),n.d(r,"fromValues",function(){return _}),n.d(r,"set",function(){return h}),n.d(r,"identity",function(){return T}),n.d(r,"transpose",function(){return g}),n.d(r,"invert",function(){return m}),n.d(r,"adjoint",function(){return A}),n.d(r,"determinant",function(){return R}),n.d(r,"multiply",function(){return M}),n.d(r,"translate",function(){return p}),n.d(r,"scale",function(){return S}),n.d(r,"rotate",function(){return v}),n.d(r,"rotateX",function(){return N}),n.d(r,"rotateY",function(){return I}),n.d(r,"rotateZ",function(){return L}),n.d(r,"fromTranslation",function(){return b}),n.d(r,"fromScaling",function(){return C}),n.d(r,"fromRotation",function(){return O}),n.d(r,"fromXRotation",function(){return P}),n.d(r,"fromYRotation",function(){return U}),n.d(r,"fromZRotation",function(){return F}),n.d(r,"fromRotationTranslation",function(){return y}),n.d(r,"fromQuat2",function(){return x}),n.d(r,"getTranslation",function(){return w}),n.d(r,"getScaling",function(){return B}),n.d(r,"getRotation",function(){return D}),n.d(r,"fromRotationTranslationScale",function(){return H}),n.d(r,"fromRotationTranslationScaleOrigin",function(){return V}),n.d(r,"fromQuat",function(){return G}),n.d(r,"frustum",function(){return X}),n.d(r,"perspective",function(){return k}),n.d(r,"perspectiveFromFieldOfView",function(){return W}),n.d(r,"ortho",function(){return j}),n.d(r,"lookAt",function(){return Y}),n.d(r,"targetTo",function(){return q}),n.d(r,"str",function(){return K}),n.d(r,"frob",function(){return z}),n.d(r,"add",function(){return $}),n.d(r,"subtract",function(){return Z}),n.d(r,"multiplyScalar",function(){return Q}),n.d(r,"multiplyScalarAndAdd",function(){return J}),n.d(r,"exactEquals",function(){return ee}),n.d(r,"equals",function(){return te}),n.d(r,"mul",function(){return ne}),n.d(r,"sub",function(){return re});var o={};n.r(o),n.d(o,"create",function(){return oe}),n.d(o,"clone",function(){return ae}),n.d(o,"length",function(){return ie}),n.d(o,"fromValues",function(){return se}),n.d(o,"copy",function(){return ue}),n.d(o,"set",function(){return ce}),n.d(o,"add",function(){return le}),n.d(o,"subtract",function(){return fe}),n.d(o,"multiply",function(){return Ee}),n.d(o,"divide",function(){return de}),n.d(o,"ceil",function(){return _e}),n.d(o,"floor",function(){return he}),n.d(o,"min",function(){return Te}),n.d(o,"max",function(){return ge}),n.d(o,"round",function(){return me}),n.d(o,"scale",function(){return Ae}),n.d(o,"scaleAndAdd",function(){return Re}),n.d(o,"distance",function(){return Me}),n.d(o,"squaredDistance",function(){return pe}),n.d(o,"squaredLength",function(){return Se}),n.d(o,"negate",function(){return ve}),n.d(o,"inverse",function(){return Ne}),n.d(o,"normalize",function(){return Ie}),n.d(o,"dot",function(){return Le}),n.d(o,"cross",function(){return be}),n.d(o,"lerp",function(){return Ce}),n.d(o,"hermite",function(){return Oe}),n.d(o,"bezier",function(){return Pe}),n.d(o,"random",function(){return Ue}),n.d(o,"transformMat4",function(){return Fe}),n.d(o,"transformMat3",function(){return ye}),n.d(o,"transformQuat",function(){return xe}),n.d(o,"rotateX",function(){return we}),n.d(o,"rotateY",function(){return Be}),n.d(o,"rotateZ",function(){return De}),n.d(o,"angle",function(){return He}),n.d(o,"str",function(){return Ve}),n.d(o,"exactEquals",function(){return Ge}),n.d(o,"equals",function(){return Xe}),n.d(o,"sub",function(){return We}),n.d(o,"mul",function(){return je}),n.d(o,"div",function(){return Ye}),n.d(o,"dist",function(){return qe}),n.d(o,"sqrDist",function(){return Ke}),n.d(o,"len",function(){return ze}),n.d(o,"sqrLen",function(){return $e}),n.d(o,"forEach",function(){return Ze});var a={};n.r(a),n.d(a,"create",function(){return Qe}),n.d(a,"clone",function(){return Je}),n.d(a,"fromValues",function(){return et}),n.d(a,"copy",function(){return tt}),n.d(a,"set",function(){return nt}),n.d(a,"add",function(){return rt}),n.d(a,"subtract",function(){return ot}),n.d(a,"multiply",function(){return at}),n.d(a,"divide",function(){return it}),n.d(a,"ceil",function(){return st}),n.d(a,"floor",function(){return ut}),n.d(a,"min",function(){return ct}),n.d(a,"max",function(){return lt}),n.d(a,"round",function(){return ft}),n.d(a,"scale",function(){return Et}),n.d(a,"scaleAndAdd",function(){return dt}),n.d(a,"distance",function(){return _t}),n.d(a,"squaredDistance",function(){return ht}),n.d(a,"length",function(){return Tt}),n.d(a,"squaredLength",function(){return gt}),n.d(a,"negate",function(){return mt}),n.d(a,"inverse",function(){return At}),n.d(a,"normalize",function(){return Rt}),n.d(a,"dot",function(){return Mt}),n.d(a,"lerp",function(){return pt}),n.d(a,"random",function(){return St}),n.d(a,"transformMat4",function(){return vt}),n.d(a,"transformQuat",function(){return Nt}),n.d(a,"str",function(){return It}),n.d(a,"exactEquals",function(){return Lt}),n.d(a,"equals",function(){return bt}),n.d(a,"sub",function(){return Ct}),n.d(a,"mul",function(){return Ot}),n.d(a,"div",function(){return Pt}),n.d(a,"dist",function(){return Ut}),n.d(a,"sqrDist",function(){return Ft}),n.d(a,"len",function(){return yt}),n.d(a,"sqrLen",function(){return xt}),n.d(a,"forEach",function(){return wt});var i={};n.r(i),n.d(i,"create",function(){return Bt}),n.d(i,"identity",function(){return Dt}),n.d(i,"setAxisAngle",function(){return Ht}),n.d(i,"getAxisAngle",function(){return Vt}),n.d(i,"multiply",function(){return Gt}),n.d(i,"rotateX",function(){return Xt}),n.d(i,"rotateY",function(){return kt}),n.d(i,"rotateZ",function(){return Wt}),n.d(i,"calculateW",function(){return jt}),n.d(i,"slerp",function(){return Yt}),n.d(i,"random",function(){return qt}),n.d(i,"invert",function(){return Kt}),n.d(i,"conjugate",function(){return zt}),n.d(i,"fromMat3",function(){return $t}),n.d(i,"fromEuler",function(){return Zt}),n.d(i,"str",function(){return Qt}),n.d(i,"clone",function(){return sn}),n.d(i,"fromValues",function(){return un}),n.d(i,"copy",function(){return cn}),n.d(i,"set",function(){return ln}),n.d(i,"add",function(){return fn}),n.d(i,"mul",function(){return En}),n.d(i,"scale",function(){return dn}),n.d(i,"dot",function(){return _n}),n.d(i,"lerp",function(){return hn}),n.d(i,"length",function(){return Tn}),n.d(i,"len",function(){return gn}),n.d(i,"squaredLength",function(){return mn}),n.d(i,"sqrLen",function(){return An}),n.d(i,"normalize",function(){return Rn}),n.d(i,"exactEquals",function(){return Mn}),n.d(i,"equals",function(){return pn}),n.d(i,"rotationTo",function(){return Sn}),n.d(i,"sqlerp",function(){return vn}),n.d(i,"setAxes",function(){return Nn});var s={};n.r(s),n.d(s,"create",function(){return In}),n.d(s,"clone",function(){return Ln}),n.d(s,"fromValues",function(){return bn}),n.d(s,"copy",function(){return Cn}),n.d(s,"set",function(){return On}),n.d(s,"add",function(){return Pn}),n.d(s,"subtract",function(){return Un}),n.d(s,"multiply",function(){return Fn}),n.d(s,"divide",function(){return yn}),n.d(s,"ceil",function(){return xn}),n.d(s,"floor",function(){return wn}),n.d(s,"min",function(){return Bn}),n.d(s,"max",function(){return Dn}),n.d(s,"round",function(){return Hn}),n.d(s,"scale",function(){return Vn}),n.d(s,"scaleAndAdd",function(){return Gn}),n.d(s,"distance",function(){return Xn}),n.d(s,"squaredDistance",function(){return kn}),n.d(s,"length",function(){return Wn}),n.d(s,"squaredLength",function(){return jn}),n.d(s,"negate",function(){return Yn}),n.d(s,"inverse",function(){return qn}),n.d(s,"normalize",function(){return Kn}),n.d(s,"dot",function(){return zn}),n.d(s,"cross",function(){return $n}),n.d(s,"lerp",function(){return Zn}),n.d(s,"random",function(){return Qn}),n.d(s,"transformMat2",function(){return Jn}),n.d(s,"transformMat2d",function(){return er}),n.d(s,"transformMat3",function(){return tr}),n.d(s,"transformMat4",function(){return nr}),n.d(s,"rotate",function(){return rr}),n.d(s,"angle",function(){return or}),n.d(s,"str",function(){return ar}),n.d(s,"exactEquals",function(){return ir}),n.d(s,"equals",function(){return sr}),n.d(s,"len",function(){return dr}),n.d(s,"sub",function(){return _r}),n.d(s,"mul",function(){return hr}),n.d(s,"div",function(){return Tr}),n.d(s,"dist",function(){return gr}),n.d(s,"sqrDist",function(){return mr}),n.d(s,"sqrLen",function(){return Ar}),n.d(s,"forEach",function(){return Rr});var u=1e-6,c="undefined"!=typeof Float32Array?Float32Array:Array,l=Math.random;Math.PI;function f(){var e=new c(16);return c!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function E(e){var t=new c(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function d(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function _(e,t,n,r,o,a,i,s,u,l,f,E,d,_,h,T){var g=new c(16);return g[0]=e,g[1]=t,g[2]=n,g[3]=r,g[4]=o,g[5]=a,g[6]=i,g[7]=s,g[8]=u,g[9]=l,g[10]=f,g[11]=E,g[12]=d,g[13]=_,g[14]=h,g[15]=T,g}function h(e,t,n,r,o,a,i,s,u,c,l,f,E,d,_,h,T){return e[0]=t,e[1]=n,e[2]=r,e[3]=o,e[4]=a,e[5]=i,e[6]=s,e[7]=u,e[8]=c,e[9]=l,e[10]=f,e[11]=E,e[12]=d,e[13]=_,e[14]=h,e[15]=T,e}function T(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function g(e,t){if(e===t){var n=t[1],r=t[2],o=t[3],a=t[6],i=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=a,e[11]=t[14],e[12]=o,e[13]=i,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function m(e,t){var n=t[0],r=t[1],o=t[2],a=t[3],i=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=t[9],E=t[10],d=t[11],_=t[12],h=t[13],T=t[14],g=t[15],m=n*s-r*i,A=n*u-o*i,R=n*c-a*i,M=r*u-o*s,p=r*c-a*s,S=o*c-a*u,v=l*h-f*_,N=l*T-E*_,I=l*g-d*_,L=f*T-E*h,b=f*g-d*h,C=E*g-d*T,O=m*C-A*b+R*L+M*I-p*N+S*v;return O?(O=1/O,e[0]=(s*C-u*b+c*L)*O,e[1]=(o*b-r*C-a*L)*O,e[2]=(h*S-T*p+g*M)*O,e[3]=(E*p-f*S-d*M)*O,e[4]=(u*I-i*C-c*N)*O,e[5]=(n*C-o*I+a*N)*O,e[6]=(T*R-_*S-g*A)*O,e[7]=(l*S-E*R+d*A)*O,e[8]=(i*b-s*I+c*v)*O,e[9]=(r*I-n*b-a*v)*O,e[10]=(_*p-h*R+g*m)*O,e[11]=(f*R-l*p-d*m)*O,e[12]=(s*N-i*L-u*v)*O,e[13]=(n*L-r*N+o*v)*O,e[14]=(h*A-_*M-T*m)*O,e[15]=(l*M-f*A+E*m)*O,e):null}function A(e,t){var n=t[0],r=t[1],o=t[2],a=t[3],i=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=t[9],E=t[10],d=t[11],_=t[12],h=t[13],T=t[14],g=t[15];return e[0]=s*(E*g-d*T)-f*(u*g-c*T)+h*(u*d-c*E),e[1]=-(r*(E*g-d*T)-f*(o*g-a*T)+h*(o*d-a*E)),e[2]=r*(u*g-c*T)-s*(o*g-a*T)+h*(o*c-a*u),e[3]=-(r*(u*d-c*E)-s*(o*d-a*E)+f*(o*c-a*u)),e[4]=-(i*(E*g-d*T)-l*(u*g-c*T)+_*(u*d-c*E)),e[5]=n*(E*g-d*T)-l*(o*g-a*T)+_*(o*d-a*E),e[6]=-(n*(u*g-c*T)-i*(o*g-a*T)+_*(o*c-a*u)),e[7]=n*(u*d-c*E)-i*(o*d-a*E)+l*(o*c-a*u),e[8]=i*(f*g-d*h)-l*(s*g-c*h)+_*(s*d-c*f),e[9]=-(n*(f*g-d*h)-l*(r*g-a*h)+_*(r*d-a*f)),e[10]=n*(s*g-c*h)-i*(r*g-a*h)+_*(r*c-a*s),e[11]=-(n*(s*d-c*f)-i*(r*d-a*f)+l*(r*c-a*s)),e[12]=-(i*(f*T-E*h)-l*(s*T-u*h)+_*(s*E-u*f)),e[13]=n*(f*T-E*h)-l*(r*T-o*h)+_*(r*E-o*f),e[14]=-(n*(s*T-u*h)-i*(r*T-o*h)+_*(r*u-o*s)),e[15]=n*(s*E-u*f)-i*(r*E-o*f)+l*(r*u-o*s),e}function R(e){var t=e[0],n=e[1],r=e[2],o=e[3],a=e[4],i=e[5],s=e[6],u=e[7],c=e[8],l=e[9],f=e[10],E=e[11],d=e[12],_=e[13],h=e[14],T=e[15];return(t*i-n*a)*(f*T-E*h)-(t*s-r*a)*(l*T-E*_)+(t*u-o*a)*(l*h-f*_)+(n*s-r*i)*(c*T-E*d)-(n*u-o*i)*(c*h-f*d)+(r*u-o*s)*(c*_-l*d)}function M(e,t,n){var r=t[0],o=t[1],a=t[2],i=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=t[8],E=t[9],d=t[10],_=t[11],h=t[12],T=t[13],g=t[14],m=t[15],A=n[0],R=n[1],M=n[2],p=n[3];return e[0]=A*r+R*s+M*f+p*h,e[1]=A*o+R*u+M*E+p*T,e[2]=A*a+R*c+M*d+p*g,e[3]=A*i+R*l+M*_+p*m,A=n[4],R=n[5],M=n[6],p=n[7],e[4]=A*r+R*s+M*f+p*h,e[5]=A*o+R*u+M*E+p*T,e[6]=A*a+R*c+M*d+p*g,e[7]=A*i+R*l+M*_+p*m,A=n[8],R=n[9],M=n[10],p=n[11],e[8]=A*r+R*s+M*f+p*h,e[9]=A*o+R*u+M*E+p*T,e[10]=A*a+R*c+M*d+p*g,e[11]=A*i+R*l+M*_+p*m,A=n[12],R=n[13],M=n[14],p=n[15],e[12]=A*r+R*s+M*f+p*h,e[13]=A*o+R*u+M*E+p*T,e[14]=A*a+R*c+M*d+p*g,e[15]=A*i+R*l+M*_+p*m,e}function p(e,t,n){var r=n[0],o=n[1],a=n[2],i=void 0,s=void 0,u=void 0,c=void 0,l=void 0,f=void 0,E=void 0,d=void 0,_=void 0,h=void 0,T=void 0,g=void 0;return t===e?(e[12]=t[0]*r+t[4]*o+t[8]*a+t[12],e[13]=t[1]*r+t[5]*o+t[9]*a+t[13],e[14]=t[2]*r+t[6]*o+t[10]*a+t[14],e[15]=t[3]*r+t[7]*o+t[11]*a+t[15]):(i=t[0],s=t[1],u=t[2],c=t[3],l=t[4],f=t[5],E=t[6],d=t[7],_=t[8],h=t[9],T=t[10],g=t[11],e[0]=i,e[1]=s,e[2]=u,e[3]=c,e[4]=l,e[5]=f,e[6]=E,e[7]=d,e[8]=_,e[9]=h,e[10]=T,e[11]=g,e[12]=i*r+l*o+_*a+t[12],e[13]=s*r+f*o+h*a+t[13],e[14]=u*r+E*o+T*a+t[14],e[15]=c*r+d*o+g*a+t[15]),e}function S(e,t,n){var r=n[0],o=n[1],a=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7]*o,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function v(e,t,n,r){var o,a,i,s,c,l,f,E,d,_,h,T,g,m,A,R,M,p,S,v,N,I,L,b,C=r[0],O=r[1],P=r[2],U=Math.sqrt(C*C+O*O+P*P);return U<u?null:(C*=U=1/U,O*=U,P*=U,o=Math.sin(n),i=1-(a=Math.cos(n)),s=t[0],c=t[1],l=t[2],f=t[3],E=t[4],d=t[5],_=t[6],h=t[7],T=t[8],g=t[9],m=t[10],A=t[11],R=C*C*i+a,M=O*C*i+P*o,p=P*C*i-O*o,S=C*O*i-P*o,v=O*O*i+a,N=P*O*i+C*o,I=C*P*i+O*o,L=O*P*i-C*o,b=P*P*i+a,e[0]=s*R+E*M+T*p,e[1]=c*R+d*M+g*p,e[2]=l*R+_*M+m*p,e[3]=f*R+h*M+A*p,e[4]=s*S+E*v+T*N,e[5]=c*S+d*v+g*N,e[6]=l*S+_*v+m*N,e[7]=f*S+h*v+A*N,e[8]=s*I+E*L+T*b,e[9]=c*I+d*L+g*b,e[10]=l*I+_*L+m*b,e[11]=f*I+h*L+A*b,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function N(e,t,n){var r=Math.sin(n),o=Math.cos(n),a=t[4],i=t[5],s=t[6],u=t[7],c=t[8],l=t[9],f=t[10],E=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*o+c*r,e[5]=i*o+l*r,e[6]=s*o+f*r,e[7]=u*o+E*r,e[8]=c*o-a*r,e[9]=l*o-i*r,e[10]=f*o-s*r,e[11]=E*o-u*r,e}function I(e,t,n){var r=Math.sin(n),o=Math.cos(n),a=t[0],i=t[1],s=t[2],u=t[3],c=t[8],l=t[9],f=t[10],E=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*o-c*r,e[1]=i*o-l*r,e[2]=s*o-f*r,e[3]=u*o-E*r,e[8]=a*r+c*o,e[9]=i*r+l*o,e[10]=s*r+f*o,e[11]=u*r+E*o,e}function L(e,t,n){var r=Math.sin(n),o=Math.cos(n),a=t[0],i=t[1],s=t[2],u=t[3],c=t[4],l=t[5],f=t[6],E=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*o+c*r,e[1]=i*o+l*r,e[2]=s*o+f*r,e[3]=u*o+E*r,e[4]=c*o-a*r,e[5]=l*o-i*r,e[6]=f*o-s*r,e[7]=E*o-u*r,e}function b(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function C(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function O(e,t,n){var r,o,a,i=n[0],s=n[1],c=n[2],l=Math.sqrt(i*i+s*s+c*c);return l<u?null:(i*=l=1/l,s*=l,c*=l,r=Math.sin(t),a=1-(o=Math.cos(t)),e[0]=i*i*a+o,e[1]=s*i*a+c*r,e[2]=c*i*a-s*r,e[3]=0,e[4]=i*s*a-c*r,e[5]=s*s*a+o,e[6]=c*s*a+i*r,e[7]=0,e[8]=i*c*a+s*r,e[9]=s*c*a-i*r,e[10]=c*c*a+o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function P(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function U(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function F(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function y(e,t,n){var r=t[0],o=t[1],a=t[2],i=t[3],s=r+r,u=o+o,c=a+a,l=r*s,f=r*u,E=r*c,d=o*u,_=o*c,h=a*c,T=i*s,g=i*u,m=i*c;return e[0]=1-(d+h),e[1]=f+m,e[2]=E-g,e[3]=0,e[4]=f-m,e[5]=1-(l+h),e[6]=_+T,e[7]=0,e[8]=E+g,e[9]=_-T,e[10]=1-(l+d),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function x(e,t){var n=new c(3),r=-t[0],o=-t[1],a=-t[2],i=t[3],s=t[4],u=t[5],l=t[6],f=t[7],E=r*r+o*o+a*a+i*i;return E>0?(n[0]=2*(s*i+f*r+u*a-l*o)/E,n[1]=2*(u*i+f*o+l*r-s*a)/E,n[2]=2*(l*i+f*a+s*o-u*r)/E):(n[0]=2*(s*i+f*r+u*a-l*o),n[1]=2*(u*i+f*o+l*r-s*a),n[2]=2*(l*i+f*a+s*o-u*r)),y(e,t,n),e}function w(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function B(e,t){var n=t[0],r=t[1],o=t[2],a=t[4],i=t[5],s=t[6],u=t[8],c=t[9],l=t[10];return e[0]=Math.sqrt(n*n+r*r+o*o),e[1]=Math.sqrt(a*a+i*i+s*s),e[2]=Math.sqrt(u*u+c*c+l*l),e}function D(e,t){var n=t[0]+t[5]+t[10],r=0;return n>0?(r=2*Math.sqrt(n+1),e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e}function H(e,t,n,r){var o=t[0],a=t[1],i=t[2],s=t[3],u=o+o,c=a+a,l=i+i,f=o*u,E=o*c,d=o*l,_=a*c,h=a*l,T=i*l,g=s*u,m=s*c,A=s*l,R=r[0],M=r[1],p=r[2];return e[0]=(1-(_+T))*R,e[1]=(E+A)*R,e[2]=(d-m)*R,e[3]=0,e[4]=(E-A)*M,e[5]=(1-(f+T))*M,e[6]=(h+g)*M,e[7]=0,e[8]=(d+m)*p,e[9]=(h-g)*p,e[10]=(1-(f+_))*p,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function V(e,t,n,r,o){var a=t[0],i=t[1],s=t[2],u=t[3],c=a+a,l=i+i,f=s+s,E=a*c,d=a*l,_=a*f,h=i*l,T=i*f,g=s*f,m=u*c,A=u*l,R=u*f,M=r[0],p=r[1],S=r[2],v=o[0],N=o[1],I=o[2],L=(1-(h+g))*M,b=(d+R)*M,C=(_-A)*M,O=(d-R)*p,P=(1-(E+g))*p,U=(T+m)*p,F=(_+A)*S,y=(T-m)*S,x=(1-(E+h))*S;return e[0]=L,e[1]=b,e[2]=C,e[3]=0,e[4]=O,e[5]=P,e[6]=U,e[7]=0,e[8]=F,e[9]=y,e[10]=x,e[11]=0,e[12]=n[0]+v-(L*v+O*N+F*I),e[13]=n[1]+N-(b*v+P*N+y*I),e[14]=n[2]+I-(C*v+U*N+x*I),e[15]=1,e}function G(e,t){var n=t[0],r=t[1],o=t[2],a=t[3],i=n+n,s=r+r,u=o+o,c=n*i,l=r*i,f=r*s,E=o*i,d=o*s,_=o*u,h=a*i,T=a*s,g=a*u;return e[0]=1-f-_,e[1]=l+g,e[2]=E-T,e[3]=0,e[4]=l-g,e[5]=1-c-_,e[6]=d+h,e[7]=0,e[8]=E+T,e[9]=d-h,e[10]=1-c-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function X(e,t,n,r,o,a,i){var s=1/(n-t),u=1/(o-r),c=1/(a-i);return e[0]=2*a*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*u,e[6]=0,e[7]=0,e[8]=(n+t)*s,e[9]=(o+r)*u,e[10]=(i+a)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=i*a*2*c,e[15]=0,e}function k(e,t,n,r,o){var a=1/Math.tan(t/2),i=void 0;return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=o&&o!==1/0?(i=1/(r-o),e[10]=(o+r)*i,e[14]=2*o*r*i):(e[10]=-1,e[14]=-2*r),e}function W(e,t,n,r){var o=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),i=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),u=2/(i+s),c=2/(o+a);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(i-s)*u*.5,e[9]=(o-a)*c*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e}function j(e,t,n,r,o,a,i){var s=1/(t-n),u=1/(r-o),c=1/(a-i);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*s,e[13]=(o+r)*u,e[14]=(i+a)*c,e[15]=1,e}function Y(e,t,n,r){var o=void 0,a=void 0,i=void 0,s=void 0,c=void 0,l=void 0,f=void 0,E=void 0,d=void 0,_=void 0,h=t[0],g=t[1],m=t[2],A=r[0],R=r[1],M=r[2],p=n[0],S=n[1],v=n[2];return Math.abs(h-p)<u&&Math.abs(g-S)<u&&Math.abs(m-v)<u?T(e):(f=h-p,E=g-S,d=m-v,o=R*(d*=_=1/Math.sqrt(f*f+E*E+d*d))-M*(E*=_),a=M*(f*=_)-A*d,i=A*E-R*f,(_=Math.sqrt(o*o+a*a+i*i))?(o*=_=1/_,a*=_,i*=_):(o=0,a=0,i=0),s=E*i-d*a,c=d*o-f*i,l=f*a-E*o,(_=Math.sqrt(s*s+c*c+l*l))?(s*=_=1/_,c*=_,l*=_):(s=0,c=0,l=0),e[0]=o,e[1]=s,e[2]=f,e[3]=0,e[4]=a,e[5]=c,e[6]=E,e[7]=0,e[8]=i,e[9]=l,e[10]=d,e[11]=0,e[12]=-(o*h+a*g+i*m),e[13]=-(s*h+c*g+l*m),e[14]=-(f*h+E*g+d*m),e[15]=1,e)}function q(e,t,n,r){var o=t[0],a=t[1],i=t[2],s=r[0],u=r[1],c=r[2],l=o-n[0],f=a-n[1],E=i-n[2],d=l*l+f*f+E*E;d>0&&(l*=d=1/Math.sqrt(d),f*=d,E*=d);var _=u*E-c*f,h=c*l-s*E,T=s*f-u*l;return(d=_*_+h*h+T*T)>0&&(_*=d=1/Math.sqrt(d),h*=d,T*=d),e[0]=_,e[1]=h,e[2]=T,e[3]=0,e[4]=f*T-E*h,e[5]=E*_-l*T,e[6]=l*h-f*_,e[7]=0,e[8]=l,e[9]=f,e[10]=E,e[11]=0,e[12]=o,e[13]=a,e[14]=i,e[15]=1,e}function K(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function z(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))}function $(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e}function Z(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function Q(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e}function J(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e}function ee(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function te(e,t){var n=e[0],r=e[1],o=e[2],a=e[3],i=e[4],s=e[5],c=e[6],l=e[7],f=e[8],E=e[9],d=e[10],_=e[11],h=e[12],T=e[13],g=e[14],m=e[15],A=t[0],R=t[1],M=t[2],p=t[3],S=t[4],v=t[5],N=t[6],I=t[7],L=t[8],b=t[9],C=t[10],O=t[11],P=t[12],U=t[13],F=t[14],y=t[15];return Math.abs(n-A)<=u*Math.max(1,Math.abs(n),Math.abs(A))&&Math.abs(r-R)<=u*Math.max(1,Math.abs(r),Math.abs(R))&&Math.abs(o-M)<=u*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(a-p)<=u*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(i-S)<=u*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(s-v)<=u*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(c-N)<=u*Math.max(1,Math.abs(c),Math.abs(N))&&Math.abs(l-I)<=u*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(f-L)<=u*Math.max(1,Math.abs(f),Math.abs(L))&&Math.abs(E-b)<=u*Math.max(1,Math.abs(E),Math.abs(b))&&Math.abs(d-C)<=u*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(_-O)<=u*Math.max(1,Math.abs(_),Math.abs(O))&&Math.abs(h-P)<=u*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(T-U)<=u*Math.max(1,Math.abs(T),Math.abs(U))&&Math.abs(g-F)<=u*Math.max(1,Math.abs(g),Math.abs(F))&&Math.abs(m-y)<=u*Math.max(1,Math.abs(m),Math.abs(y))}var ne=M,re=Z;function oe(){var e=new c(3);return c!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function ae(e){var t=new c(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function ie(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)}function se(e,t,n){var r=new c(3);return r[0]=e,r[1]=t,r[2]=n,r}function ue(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ce(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function le(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function fe(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function Ee(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function de(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function _e(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function he(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function Te(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function ge(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function me(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function Ae(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function Re(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function Me(e,t){var n=t[0]-e[0],r=t[1]-e[1],o=t[2]-e[2];return Math.sqrt(n*n+r*r+o*o)}function pe(e,t){var n=t[0]-e[0],r=t[1]-e[1],o=t[2]-e[2];return n*n+r*r+o*o}function Se(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function ve(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function Ne(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function Ie(e,t){var n=t[0],r=t[1],o=t[2],a=n*n+r*r+o*o;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}function Le(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function be(e,t,n){var r=t[0],o=t[1],a=t[2],i=n[0],s=n[1],u=n[2];return e[0]=o*u-a*s,e[1]=a*i-r*u,e[2]=r*s-o*i,e}function Ce(e,t,n,r){var o=t[0],a=t[1],i=t[2];return e[0]=o+r*(n[0]-o),e[1]=a+r*(n[1]-a),e[2]=i+r*(n[2]-i),e}function Oe(e,t,n,r,o,a){var i=a*a,s=i*(2*a-3)+1,u=i*(a-2)+a,c=i*(a-1),l=i*(3-2*a);return e[0]=t[0]*s+n[0]*u+r[0]*c+o[0]*l,e[1]=t[1]*s+n[1]*u+r[1]*c+o[1]*l,e[2]=t[2]*s+n[2]*u+r[2]*c+o[2]*l,e}function Pe(e,t,n,r,o,a){var i=1-a,s=i*i,u=a*a,c=s*i,l=3*a*s,f=3*u*i,E=u*a;return e[0]=t[0]*c+n[0]*l+r[0]*f+o[0]*E,e[1]=t[1]*c+n[1]*l+r[1]*f+o[1]*E,e[2]=t[2]*c+n[2]*l+r[2]*f+o[2]*E,e}function Ue(e,t){t=t||1;var n=2*l()*Math.PI,r=2*l()-1,o=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*o,e[1]=Math.sin(n)*o,e[2]=r*t,e}function Fe(e,t,n){var r=t[0],o=t[1],a=t[2],i=n[3]*r+n[7]*o+n[11]*a+n[15];return i=i||1,e[0]=(n[0]*r+n[4]*o+n[8]*a+n[12])/i,e[1]=(n[1]*r+n[5]*o+n[9]*a+n[13])/i,e[2]=(n[2]*r+n[6]*o+n[10]*a+n[14])/i,e}function ye(e,t,n){var r=t[0],o=t[1],a=t[2];return e[0]=r*n[0]+o*n[3]+a*n[6],e[1]=r*n[1]+o*n[4]+a*n[7],e[2]=r*n[2]+o*n[5]+a*n[8],e}function xe(e,t,n){var r=n[0],o=n[1],a=n[2],i=n[3],s=t[0],u=t[1],c=t[2],l=o*c-a*u,f=a*s-r*c,E=r*u-o*s,d=o*E-a*f,_=a*l-r*E,h=r*f-o*l,T=2*i;return l*=T,f*=T,E*=T,d*=2,_*=2,h*=2,e[0]=s+l+d,e[1]=u+f+_,e[2]=c+E+h,e}function we(e,t,n,r){var o=[],a=[];return o[0]=t[0]-n[0],o[1]=t[1]-n[1],o[2]=t[2]-n[2],a[0]=o[0],a[1]=o[1]*Math.cos(r)-o[2]*Math.sin(r),a[2]=o[1]*Math.sin(r)+o[2]*Math.cos(r),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function Be(e,t,n,r){var o=[],a=[];return o[0]=t[0]-n[0],o[1]=t[1]-n[1],o[2]=t[2]-n[2],a[0]=o[2]*Math.sin(r)+o[0]*Math.cos(r),a[1]=o[1],a[2]=o[2]*Math.cos(r)-o[0]*Math.sin(r),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function De(e,t,n,r){var o=[],a=[];return o[0]=t[0]-n[0],o[1]=t[1]-n[1],o[2]=t[2]-n[2],a[0]=o[0]*Math.cos(r)-o[1]*Math.sin(r),a[1]=o[0]*Math.sin(r)+o[1]*Math.cos(r),a[2]=o[2],e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function He(e,t){var n=se(e[0],e[1],e[2]),r=se(t[0],t[1],t[2]);Ie(n,n),Ie(r,r);var o=Le(n,r);return o>1?0:o<-1?Math.PI:Math.acos(o)}function Ve(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Ge(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Xe(e,t){var n=e[0],r=e[1],o=e[2],a=t[0],i=t[1],s=t[2];return Math.abs(n-a)<=u*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-i)<=u*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(o-s)<=u*Math.max(1,Math.abs(o),Math.abs(s))}var ke,We=fe,je=Ee,Ye=de,qe=Me,Ke=pe,ze=ie,$e=Se,Ze=(ke=oe(),function(e,t,n,r,o,a){var i=void 0,s=void 0;for(t||(t=3),n||(n=0),s=r?Math.min(r*t+n,e.length):e.length,i=n;i<s;i+=t)ke[0]=e[i],ke[1]=e[i+1],ke[2]=e[i+2],o(ke,ke,a),e[i]=ke[0],e[i+1]=ke[1],e[i+2]=ke[2];return e});function Qe(){var e=new c(4);return c!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Je(e){var t=new c(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function et(e,t,n,r){var o=new c(4);return o[0]=e,o[1]=t,o[2]=n,o[3]=r,o}function tt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function nt(e,t,n,r,o){return e[0]=t,e[1]=n,e[2]=r,e[3]=o,e}function rt(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function ot(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function at(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}function it(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e}function st(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function ut(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function ct(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e}function lt(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e}function ft(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function Et(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function dt(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e}function _t(e,t){var n=t[0]-e[0],r=t[1]-e[1],o=t[2]-e[2],a=t[3]-e[3];return Math.sqrt(n*n+r*r+o*o+a*a)}function ht(e,t){var n=t[0]-e[0],r=t[1]-e[1],o=t[2]-e[2],a=t[3]-e[3];return n*n+r*r+o*o+a*a}function Tt(e){var t=e[0],n=e[1],r=e[2],o=e[3];return Math.sqrt(t*t+n*n+r*r+o*o)}function gt(e){var t=e[0],n=e[1],r=e[2],o=e[3];return t*t+n*n+r*r+o*o}function mt(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function At(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function Rt(e,t){var n=t[0],r=t[1],o=t[2],a=t[3],i=n*n+r*r+o*o+a*a;return i>0&&(i=1/Math.sqrt(i),e[0]=n*i,e[1]=r*i,e[2]=o*i,e[3]=a*i),e}function Mt(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function pt(e,t,n,r){var o=t[0],a=t[1],i=t[2],s=t[3];return e[0]=o+r*(n[0]-o),e[1]=a+r*(n[1]-a),e[2]=i+r*(n[2]-i),e[3]=s+r*(n[3]-s),e}function St(e,t){var n,r,o,a,i,s;t=t||1;do{i=(n=2*l()-1)*n+(r=2*l()-1)*r}while(i>=1);do{s=(o=2*l()-1)*o+(a=2*l()-1)*a}while(s>=1);var u=Math.sqrt((1-i)/s);return e[0]=t*n,e[1]=t*r,e[2]=t*o*u,e[3]=t*a*u,e}function vt(e,t,n){var r=t[0],o=t[1],a=t[2],i=t[3];return e[0]=n[0]*r+n[4]*o+n[8]*a+n[12]*i,e[1]=n[1]*r+n[5]*o+n[9]*a+n[13]*i,e[2]=n[2]*r+n[6]*o+n[10]*a+n[14]*i,e[3]=n[3]*r+n[7]*o+n[11]*a+n[15]*i,e}function Nt(e,t,n){var r=t[0],o=t[1],a=t[2],i=n[0],s=n[1],u=n[2],c=n[3],l=c*r+s*a-u*o,f=c*o+u*r-i*a,E=c*a+i*o-s*r,d=-i*r-s*o-u*a;return e[0]=l*c+d*-i+f*-u-E*-s,e[1]=f*c+d*-s+E*-i-l*-u,e[2]=E*c+d*-u+l*-s-f*-i,e[3]=t[3],e}function It(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Lt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function bt(e,t){var n=e[0],r=e[1],o=e[2],a=e[3],i=t[0],s=t[1],c=t[2],l=t[3];return Math.abs(n-i)<=u*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-s)<=u*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(o-c)<=u*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(a-l)<=u*Math.max(1,Math.abs(a),Math.abs(l))}var Ct=ot,Ot=at,Pt=it,Ut=_t,Ft=ht,yt=Tt,xt=gt,wt=function(){var e=Qe();return function(t,n,r,o,a,i){var s=void 0,u=void 0;for(n||(n=4),r||(r=0),u=o?Math.min(o*n+r,t.length):t.length,s=r;s<u;s+=n)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],a(e,e,i),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}();function Bt(){var e=new c(4);return c!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Dt(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Ht(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function Vt(e,t){var n=2*Math.acos(t[3]),r=Math.sin(n/2);return r>u?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),n}function Gt(e,t,n){var r=t[0],o=t[1],a=t[2],i=t[3],s=n[0],u=n[1],c=n[2],l=n[3];return e[0]=r*l+i*s+o*c-a*u,e[1]=o*l+i*u+a*s-r*c,e[2]=a*l+i*c+r*u-o*s,e[3]=i*l-r*s-o*u-a*c,e}function Xt(e,t,n){n*=.5;var r=t[0],o=t[1],a=t[2],i=t[3],s=Math.sin(n),u=Math.cos(n);return e[0]=r*u+i*s,e[1]=o*u+a*s,e[2]=a*u-o*s,e[3]=i*u-r*s,e}function kt(e,t,n){n*=.5;var r=t[0],o=t[1],a=t[2],i=t[3],s=Math.sin(n),u=Math.cos(n);return e[0]=r*u-a*s,e[1]=o*u+i*s,e[2]=a*u+r*s,e[3]=i*u-o*s,e}function Wt(e,t,n){n*=.5;var r=t[0],o=t[1],a=t[2],i=t[3],s=Math.sin(n),u=Math.cos(n);return e[0]=r*u+o*s,e[1]=o*u-r*s,e[2]=a*u+i*s,e[3]=i*u-a*s,e}function jt(e,t){var n=t[0],r=t[1],o=t[2];return e[0]=n,e[1]=r,e[2]=o,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-o*o)),e}function Yt(e,t,n,r){var o=t[0],a=t[1],i=t[2],s=t[3],c=n[0],l=n[1],f=n[2],E=n[3],d=void 0,_=void 0,h=void 0,T=void 0,g=void 0;return(_=o*c+a*l+i*f+s*E)<0&&(_=-_,c=-c,l=-l,f=-f,E=-E),1-_>u?(d=Math.acos(_),h=Math.sin(d),T=Math.sin((1-r)*d)/h,g=Math.sin(r*d)/h):(T=1-r,g=r),e[0]=T*o+g*c,e[1]=T*a+g*l,e[2]=T*i+g*f,e[3]=T*s+g*E,e}function qt(e){var t=l(),n=l(),r=l(),o=Math.sqrt(1-t),a=Math.sqrt(t);return e[0]=o*Math.sin(2*Math.PI*n),e[1]=o*Math.cos(2*Math.PI*n),e[2]=a*Math.sin(2*Math.PI*r),e[3]=a*Math.cos(2*Math.PI*r),e}function Kt(e,t){var n=t[0],r=t[1],o=t[2],a=t[3],i=n*n+r*r+o*o+a*a,s=i?1/i:0;return e[0]=-n*s,e[1]=-r*s,e[2]=-o*s,e[3]=a*s,e}function zt(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function $t(e,t){var n=t[0]+t[4]+t[8],r=void 0;if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var o=0;t[4]>t[0]&&(o=1),t[8]>t[3*o+o]&&(o=2);var a=(o+1)%3,i=(o+2)%3;r=Math.sqrt(t[3*o+o]-t[3*a+a]-t[3*i+i]+1),e[o]=.5*r,r=.5/r,e[3]=(t[3*a+i]-t[3*i+a])*r,e[a]=(t[3*a+o]+t[3*o+a])*r,e[i]=(t[3*i+o]+t[3*o+i])*r}return e}function Zt(e,t,n,r){var o=.5*Math.PI/180;t*=o,n*=o,r*=o;var a=Math.sin(t),i=Math.cos(t),s=Math.sin(n),u=Math.cos(n),c=Math.sin(r),l=Math.cos(r);return e[0]=a*u*l-i*s*c,e[1]=i*s*l+a*u*c,e[2]=i*u*c-a*s*l,e[3]=i*u*l+a*s*c,e}function Qt(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var Jt,en,tn,nn,rn,on,an,sn=Je,un=et,cn=tt,ln=nt,fn=rt,En=Gt,dn=Et,_n=Mt,hn=pt,Tn=Tt,gn=Tn,mn=gt,An=mn,Rn=Rt,Mn=Lt,pn=bt,Sn=(Jt=oe(),en=se(1,0,0),tn=se(0,1,0),function(e,t,n){var r=Le(t,n);return r<-.999999?(be(Jt,en,t),ze(Jt)<1e-6&&be(Jt,tn,t),Ie(Jt,Jt),Ht(e,Jt,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(be(Jt,t,n),e[0]=Jt[0],e[1]=Jt[1],e[2]=Jt[2],e[3]=1+r,Rn(e,e))}),vn=(nn=Bt(),rn=Bt(),function(e,t,n,r,o,a){return Yt(nn,t,o,a),Yt(rn,n,r,a),Yt(e,nn,rn,2*a*(1-a)),e}),Nn=(on=new c(9),c!=Float32Array&&(on[1]=0,on[2]=0,on[3]=0,on[5]=0,on[6]=0,on[7]=0),on[0]=1,on[4]=1,on[8]=1,an=on,function(e,t,n,r){return an[0]=n[0],an[3]=n[1],an[6]=n[2],an[1]=r[0],an[4]=r[1],an[7]=r[2],an[2]=-t[0],an[5]=-t[1],an[8]=-t[2],Rn(e,$t(e,an))});function In(){var e=new c(2);return c!=Float32Array&&(e[0]=0,e[1]=0),e}function Ln(e){var t=new c(2);return t[0]=e[0],t[1]=e[1],t}function bn(e,t){var n=new c(2);return n[0]=e,n[1]=t,n}function Cn(e,t){return e[0]=t[0],e[1]=t[1],e}function On(e,t,n){return e[0]=t,e[1]=n,e}function Pn(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function Un(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function Fn(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function yn(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}function xn(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function wn(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function Bn(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e}function Dn(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e}function Hn(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function Vn(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function Gn(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e}function Xn(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}function kn(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}function Wn(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)}function jn(e){var t=e[0],n=e[1];return t*t+n*n}function Yn(e,t){return e[0]=-t[0],e[1]=-t[1],e}function qn(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function Kn(e,t){var n=t[0],r=t[1],o=n*n+r*r;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o),e}function zn(e,t){return e[0]*t[0]+e[1]*t[1]}function $n(e,t,n){var r=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=r,e}function Zn(e,t,n,r){var o=t[0],a=t[1];return e[0]=o+r*(n[0]-o),e[1]=a+r*(n[1]-a),e}function Qn(e,t){t=t||1;var n=2*l()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e}function Jn(e,t,n){var r=t[0],o=t[1];return e[0]=n[0]*r+n[2]*o,e[1]=n[1]*r+n[3]*o,e}function er(e,t,n){var r=t[0],o=t[1];return e[0]=n[0]*r+n[2]*o+n[4],e[1]=n[1]*r+n[3]*o+n[5],e}function tr(e,t,n){var r=t[0],o=t[1];return e[0]=n[0]*r+n[3]*o+n[6],e[1]=n[1]*r+n[4]*o+n[7],e}function nr(e,t,n){var r=t[0],o=t[1];return e[0]=n[0]*r+n[4]*o+n[12],e[1]=n[1]*r+n[5]*o+n[13],e}function rr(e,t,n,r){var o=t[0]-n[0],a=t[1]-n[1],i=Math.sin(r),s=Math.cos(r);return e[0]=o*s-a*i+n[0],e[1]=o*i+a*s+n[1],e}function or(e,t){var n=e[0],r=e[1],o=t[0],a=t[1],i=n*n+r*r;i>0&&(i=1/Math.sqrt(i));var s=o*o+a*a;s>0&&(s=1/Math.sqrt(s));var u=(n*o+r*a)*i*s;return u>1?0:u<-1?Math.PI:Math.acos(u)}function ar(e){return"vec2("+e[0]+", "+e[1]+")"}function ir(e,t){return e[0]===t[0]&&e[1]===t[1]}function sr(e,t){var n=e[0],r=e[1],o=t[0],a=t[1];return Math.abs(n-o)<=u*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=u*Math.max(1,Math.abs(r),Math.abs(a))}var ur,cr,lr,fr,Er,dr=Wn,_r=Un,hr=Fn,Tr=yn,gr=Xn,mr=kn,Ar=jn,Rr=function(){var e=In();return function(t,n,r,o,a,i){var s=void 0,u=void 0;for(n||(n=2),r||(r=0),u=o?Math.min(o*n+r,t.length):t.length,s=r;s<u;s+=n)e[0]=t[s],e[1]=t[s+1],a(e,e,i),t[s]=e[0],t[s+1]=e[1];return t}}();!function(e){e[e.TRANSLATION=1]="TRANSLATION",e[e.ROTATION=2]="ROTATION",e[e.SCALE=3]="SCALE",e[e.WEIGHTS=4]="WEIGHTS"}(ur||(ur={})),function(e){e[e.LINEAR=1]="LINEAR",e[e.STEP=2]="STEP",e[e.CUBICSPLINE=3]="CUBICSPLINE"}(cr||(cr={})),function(e){e[e.OPAQUE=1]="OPAQUE",e[e.MASK=2]="MASK",e[e.BLEND=3]="BLEND"}(lr||(lr={})),function(e){e[e.MESH=3]="MESH",e[e.SKIN=4]="SKIN"}(fr||(fr={})),function(e){e[e.ELEMENTS=1]="ELEMENTS",e[e.ARRAY=2]="ARRAY"}(Er||(Er={}));var Mr,pr,Sr,vr;!function(e){e[e.PERSPECTIVE=0]="PERSPECTIVE",e[e.ORTHOGRAPHIC=1]="ORTHOGRAPHIC"}(Mr||(Mr={})),function(e){e[e.CAMERA=1]="CAMERA",e[e.LIGHT=2]="LIGHT"}(pr||(pr={})),function(e){e[e.Directional=1]="Directional",e[e.Point=2]="Point",e[e.Spot=3]="Spot"}(Sr||(Sr={})),function(e){e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_ATTRIBUTE_MAX_LENGTH=35722]="ACTIVE_ATTRIBUTE_MAX_LENGTH",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_UNIFORM_MAX_LENGTH=35719]="ACTIVE_UNIFORM_MAX_LENGTH",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALPHA=6406]="ALPHA",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.ALWAYS=519]="ALWAYS",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.BACK=1029]="BACK",e[e.BLEND=3042]="BLEND",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.BYTE=5120]="BYTE",e[e.CCW=2305]="CCW",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CULL_FACE=2884]="CULL_FACE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.CW=2304]="CW",e[e.DECR=7683]="DECR",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DITHER=3024]="DITHER",e[e.DONT_CARE=4352]="DONT_CARE",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.EQUAL=514]="EQUAL",e[e.FASTEST=4353]="FASTEST",e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRONT=1028]="FRONT",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.GEQUAL=518]="GEQUAL",e[e.GREATER=516]="GREATER",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.INCR=7682]="INCR",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.INFO_LOG_LENGTH=35716]="INFO_LOG_LENGTH",e[e.INT=5124]="INT",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVERT=5386]="INVERT",e[e.KEEP=7680]="KEEP",e[e.LEQUAL=515]="LEQUAL",e[e.LESS=513]="LESS",e[e.LINEAR=9729]="LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.NEAREST=9728]="NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.NEVER=512]="NEVER",e[e.NICEST=4354]="NICEST",e[e.NONE=0]="NONE",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.NO_ERROR=0]="NO_ERROR",e[e.NUM_COMPRESSED_TEXTURE_FORMATS=34466]="NUM_COMPRESSED_TEXTURE_FORMATS",e[e.ONE=1]="ONE",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.POINTS=0]="POINTS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.RED_BITS=3410]="RED_BITS",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERER=7937]="RENDERER",e[e.REPEAT=10497]="REPEAT",e[e.REPLACE=7681]="REPLACE",e[e.RGB=6407]="RGB",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.RGBA=6408]="RGBA",e[e.RGBA4=32854]="RGBA4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.SHADER_COMPILER=36346]="SHADER_COMPILER",e[e.SHADER_SOURCE_LENGTH=35720]="SHADER_SOURCE_LENGTH",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.SHORT=5122]="SHORT",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.VENDOR=7936]="VENDOR",e[e.VERSION=7938]="VERSION",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.VIEWPORT=2978]="VIEWPORT",e[e.ZERO=0]="ZERO"}(vr||(vr={}));const Nr=()=>new Float64Array(3),Ir=()=>{const e=new Float64Array(16);return r.identity(e),e},Lr=()=>{const e=new Float64Array(4);return i.identity(e),e},br=e=>t=>{const n=new Float64Array(e);return n.fill(t),n},Cr=e=>t=>{const n={};n.translation=t.translation?t.translation:Nr(),n.rotation=t.rotation?t.rotation:Lr(),n.scale=t.scale?t.scale:br(3)(1);const r=Pr(n);return{trs:n,localMatrix:r,modelMatrix:Ur(e)(r)}},Or=e=>{const t=r.getScaling(Nr(),e),n=r.scale(Ir(),e,[1/t[0],1/t[1],1/t[2]]);return{translation:r.getTranslation(Nr(),e),rotation:r.getRotation((()=>new Float64Array(4))(),n),scale:t}},Pr=e=>r.fromRotationTranslationScale(Ir(),e.rotation,e.translation,e.scale),Ur=e=>t=>e?r.multiply(Ir(),e,t):t.slice(),Fr=e=>r.transpose(r.create(),r.invert(r.create(),e)),yr=e=>t=>n=>{const o=e.updateLocal?Pr(n.trs):n.localMatrix,a=e.updateModel?Ur(t)(o):n.modelMatrix,i=e.updateModel&&n.normalMatrix?Fr(a):n.normalMatrix,{modelViewMatrix:s,modelViewProjectionMatrix:u}=e.updateView?(e=>t=>{const n=r.multiply(r.create(),e.view,t);return{modelViewMatrix:n,modelViewProjectionMatrix:r.multiply(r.create(),e.projection,n)}})(e.camera)(a):n;return Object.assign({},n,{localMatrix:o,modelMatrix:a,normalMatrix:i,modelViewMatrix:s,modelViewProjectionMatrix:u})},xr=e=>e.kind==Mr.ORTHOGRAPHIC?(e=>{const t=Ir(),n=e.xmag,r=e.ymag,o=e.znear,a=e.zfar;return t[0]=1/n,t[5]=1/r,t[10]=2/(o-a),t[14]=(a+o)/(o-a),t[15]=1,t})(e):(e=>{const t=Ir(),n=void 0===e.aspectRatio&&void 0!==e.canvas?e.canvas.clientWidth/e.canvas.clientHeight:e.aspectRatio,r=e.yfov,o=e.znear,a=e.zfar;return t[0]=1/(n*Math.tan(.5*r)),t[5]=1/Math.tan(.5*r),t[10]=void 0===a?-1:(a+o)/(o-a),t[11]=-1,t[14]=void 0===a?-2*o:2*a*o/(o-a),t})(e),wr=e=>t=>Object.assign({},t,{view:(e=>r.invert(Ir(),e))(e.modelMatrix)}),Br=e=>t=>Object.assign({},t,{position:(e=>r.getTranslation(Nr(),e))(e.modelMatrix)}),Dr=e=>Br(e.transform)(wr(e.transform)((e=>t=>Object.assign({},t,{projection:xr(e)}))(e.camera.settings)(e.camera))),Hr=e=>t=>{const n=Object.assign({},e.camera.settings,{canvas:t}),r=Object.assign({},e.camera,{settings:n}),o=Object.assign({},e,{camera:r});return Dr(o)},Vr=e=>{const t=(e=>t=>{const n=r.getRotation(Lr(),t);return o.transformQuat(Nr(),e,n)})([0,0,-1])(e);return o.normalize(t,t),t},Gr=e=>t=>t.forEach(Xr(e)),Xr=e=>t=>{e(t),t.children&&t.children.forEach(Xr(e))},kr=e=>t=>t.some(Wr(e)),Wr=e=>t=>!!e(t)||!!t.children&&t.children.some(Wr(e)),jr=e=>t=>{let n;const r=t=>{if(e(t))return n=t,!0};return Array.isArray(t)?kr(r)(t):Wr(r)(t),n},Yr=e=>t=>{const n=e(t);return n.children?Object.assign(n,{children:n.children.map(Yr(e))}):n},qr=e=>t=>n=>{const r=e(t)(n);return r.children?Object.assign(r,{children:r.children.map(qr(e)(r))}):r},Kr=e=>t=>t.map(Yr(e)),zr=e=>t=>n=>(e=>t=>n=>n.map(qr(e)(t)))((e=>t=>n=>qr(t=>n=>{const o=t?t.transform.modelMatrix:void 0,a=n.transform.modelMatrix,i=yr(e)(o)(n.transform),s=i.modelMatrix,u=Object.assign({},n,{transform:i});if(e.updateLightDirection&&u.kind===pr.LIGHT){const e=u.light.kind;e!==Sr.Directional&&e!==Sr.Spot||void 0!==u.light.direction&&r.equals(a,s)||(u.light.direction=Vr(i.modelMatrix))}return u})(t)(n))(e))(t)(n),$r=({v0:e,v1:t,t:n})=>{if("number"==typeof e&&"number"==typeof t)return e*(1-n)+t*n;const r=e,i=t;if(r.length!==i.length)throw new Error("different length of animation values");switch(r.length){case 1:return $r({v0:r[0],v1:i[0],t:n});case 2:return s.lerp(s.create(),r,i,n);case 3:return o.lerp(o.create(),r,i,n);case 4:return a.lerp(a.create(),r,i,n)}},Zr=(e=>t=>n=>{const r=t.length-1,o=([r,o])=>{if(r===o)return!1;if(r<0||o<1)return!1;const a=e(t[r]),i=e(t[o]);return n>a&&n<i},a=([r,i])=>{if(i>=r){const s=0|r+(i-r)/2,u=e(t[s]);return u==n?s:o([s-1,s])?[s-1,s]:o([s,s+1])?[s,s+1]:a(u>n?[r,s-1]:[s+1,i])}return-1};return a([0,r])})(e=>e.timing),Qr={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Jr={[vr.BYTE]:1,[vr.UNSIGNED_BYTE]:1,[vr.SHORT]:2,[vr.UNSIGNED_SHORT]:2,[vr.UNSIGNED_INT]:4,[vr.FLOAT]:4},eo=({buffer:e,componentType:t})=>{switch(t){case vr.BYTE:return new Int8Array(e);case vr.UNSIGNED_BYTE:return new Uint8Array(e);case vr.SHORT:return new Int16Array(e);case vr.UNSIGNED_SHORT:return new Uint16Array(e);case vr.UNSIGNED_INT:return new Uint32Array(e);case vr.FLOAT:return new Float32Array(e);default:throw new Error("unknown accessor component type!")}},to=({info:e,buffers:t})=>void 0===e.bufferViewIndex?eo({buffer:new ArrayBuffer(e.bufferLength),componentType:e.componentType}):eo({buffer:t[e.bufferIndex].slice(e.byteOffset,e.byteOffset+e.bufferLength),componentType:e.componentType}),no=({gltf:e,info:t,buffers:n})=>{const r=to({info:t,buffers:n});if(t.sparse){const e=Qr[t.accessorType],o=to({info:t.sparse.indices,buffers:n}),a=to({info:t.sparse.values,buffers:n});o.map(t=>t*e).forEach((t,n)=>{for(let o=0;o<e;o++)r[t+o]=a[o+n*e]})}return r},ro=({gltf:e,accessorId:t})=>{const n=e.accessors[t],r=(({gltf:e,accessor:t})=>{const n=t.count*Qr[t.type]*Jr[t.componentType];if(void 0===t.bufferView){if(void 0===t.sparse)throw new Error("accessor must either be sparse or have a buffer view");return{bufferLength:n,componentType:t.componentType,accessorType:t.type}}const r=e.bufferViews[t.bufferView],o=(void 0===r.byteOffset?0:r.byteOffset)+(void 0===t.byteOffset?0:t.byteOffset);return{bufferLength:(r.byteStride?r.byteStride:0)*Qr[t.type]*Jr[t.componentType]+n,componentType:t.componentType,bufferViewIndex:t.bufferView,bufferIndex:r.buffer,byteOffset:o,accessorType:t.type}})({gltf:e,accessor:n});return n.sparse&&(r.sparse={indices:(({gltf:e,accessor:t})=>{const n=t.sparse.indices,r=t.sparse.count*Jr[n.componentType],o=e.bufferViews[n.bufferView],a=(void 0===o.byteOffset?0:o.byteOffset)+(void 0===n.byteOffset?0:n.byteOffset);return{bufferLength:r,componentType:n.componentType,bufferViewIndex:t.bufferView,bufferIndex:o.buffer,byteOffset:a,accessorType:t.type}})({gltf:e,accessor:n}),values:(({gltf:e,accessor:t})=>{const n=t.sparse.values,r=t.sparse.count*Qr[t.type]*Jr[t.componentType],o=e.bufferViews[n.bufferView],a=(void 0===o.byteOffset?0:o.byteOffset)+(void 0===n.byteOffset?0:n.byteOffset);return{bufferLength:r,componentType:t.componentType,bufferViewIndex:t.bufferView,bufferIndex:o.buffer,byteOffset:a,accessorType:t.type}})({gltf:e,accessor:n})}),r},oo={[ur.WEIGHTS]:"weights",[ur.TRANSLATION]:"translation",[ur.ROTATION]:"rotation",[ur.SCALE]:"scale"},ao={weights:ur.WEIGHTS,translation:ur.TRANSLATION,rotation:ur.ROTATION,scale:ur.SCALE},io={linear:cr.LINEAR,step:cr.STEP,cubicspline:cr.CUBICSPLINE},so=e=>t=>n=>{const r=Zr(e.keyframes)(t);if(-1===r)return;const o=Array.isArray(r)?(({k0:e,k1:t,time:n,interpolation:r,targetPath:o})=>{const a=e.values,s=t.values,u=(n-e.timing)/(t.timing-e.timing);switch(r){case cr.LINEAR:return o===ur.ROTATION?i.slerp(i.create(),a,s,u):$r({v0:a,v1:s,t:u});case cr.STEP:return a;case cr.CUBICSPLINE:throw new Error("cubicspline is not supported yet!");default:throw new Error("unsupported interpolation ")}})({k0:e.keyframes[r[0]],k1:e.keyframes[r[1]],interpolation:e.interpolation,targetPath:e.targetPath,time:t}):e.keyframes[r].values;return Object.assign({},n,e.targetPath===ur.WEIGHTS?{morphWeights:o}:{transform:Object.assign({},n.transform,{trs:Object.assign({},n.transform.trs,{[oo[e.targetPath]]:o})})})},uo=["a_Position","a_Normal","a_Tangent","a_UV","a_Color","a_Morph_0","a_Morph_1","a_Morph_2","a_Morph_3","a_Morph_4","a_Morph_5","a_Morph_6","a_Morph_7","a_Skin_Joint","a_Skin_Weight"],co=({gltf:e,buffers:t,renderer:n})=>{const r=new Map,o=new Map,a=[];e.meshes&&e.meshes.forEach(e=>{e.primitives.forEach(e=>{void 0!==e.indices&&a.push(e.indices)})}),e.accessors.map((e,t)=>({accessor:e,accessorId:t})).filter(({accessorId:t})=>(({gltf:e,accessorId:t})=>!!e.nodes&&e.nodes.some(n=>void 0!==n.mesh&&e.meshes[n.mesh].primitives.some(e=>e.indices===t||Object.keys(e.attributes).some(n=>e.attributes[n]===t)||e.targets&&e.targets.some(e=>Object.keys(e).some(n=>e[n]===t)))))({gltf:e,accessorId:t})).forEach(({accessor:i,accessorId:s})=>{const u=-1!==a.indexOf(s),c=ro({gltf:e,accessorId:s}),l=(({gltf:e,accessor:t,info:n})=>{const r=Qr[t.type],o=void 0===t.bufferView?void 0:e.bufferViews[t.bufferView],a=void 0===o||void 0===o.byteStride?0:o.byteStride;return{size:r,type:t.componentType,normalized:void 0!==t.normalized&&t.normalized,stride:a,offset:n.sparse||!t.byteOffset?0:t.byteOffset}})({gltf:e,accessor:i,info:c});let f,E;if(i.sparse)f=Symbol(`accessor ${s}`),E=no({gltf:e,buffers:t,info:c}).buffer;else{if(!r.has(c.bufferViewIndex)){const n=e.bufferViews[c.bufferViewIndex],o=n.byteOffset?n.byteOffset:0;r.set(c.bufferViewIndex,{rendererBufferId:Symbol(`${c.bufferViewIndex}`),buffer:t[c.bufferIndex].slice(o,o+n.byteLength)})}const n=r.get(c.bufferViewIndex);f=n.rendererBufferId,E=n.buffer}n.buffers.assign(f)({target:u?vr.ELEMENT_ARRAY_BUFFER:vr.ARRAY_BUFFER,usagePattern:vr.STATIC_DRAW,data:E}),o.set(s,{strategy:l,rendererBufferId:f})});const i=new Map;return{accessorLookup:o,vaoIdLookup:i}},lo=Symbol(),fo=e=>{if(!0!==e.extras[lo]){if(e.version>1)throw new Error("GLTF Renderering only supports WebGL 1.0 for now");uo.forEach(t=>{e.attributes.globalLocations.add(t)}),e.getExtension("OES_standard_derivatives"),e.getExtension("EXT_shader_texture_lod"),e.getExtension("EXT_SRGB"),e.getExtension("OES_element_index_uint"),e.extras[lo]=!0}},Eo=()=>({}),_o=e=>t=>{const{gl:n}=e,r=n.createTexture(),o=vr.TEXTURE_2D,a=e.dataSize||n.UNSIGNED_BYTE;return n.bindTexture(o,r),e.setParameters(e),(Array.isArray(t)?t:[t]).forEach((t,r)=>{t instanceof Element?n.texImage2D(o,r,e.format,e.format,a,t):n.texImage2D(o,r,e.format,e.width,e.height,0,e.format,a,t)}),r},ho=e=>t=>{const{gl:n}=e,r=n.createTexture(),o=vr.TEXTURE_CUBE_MAP,a=e.dataSize||n.UNSIGNED_BYTE;return n.bindTexture(o,r),e.setParameters(e),(Array.isArray(t)?t:[t]).forEach((t,r)=>{Object.keys(t).forEach(o=>{const i=(e=>{switch(e){case"posX":return vr.TEXTURE_CUBE_MAP_POSITIVE_X;case"negX":return vr.TEXTURE_CUBE_MAP_NEGATIVE_X;case"posY":return vr.TEXTURE_CUBE_MAP_POSITIVE_Y;case"negY":return vr.TEXTURE_CUBE_MAP_NEGATIVE_Y;case"posZ":return vr.TEXTURE_CUBE_MAP_POSITIVE_Z;case"negZ":return vr.TEXTURE_CUBE_MAP_NEGATIVE_Z}})(o),s=t[o];s instanceof Element?n.texImage2D(i,r,e.format,e.format,a,s):n.texImage2D(i,r,e.format,e.width,e.height,0,e.format,a,s)})}),r},To=e=>{--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1},go={filterMin:vr.LINEAR,filterMag:vr.LINEAR,wrapS:vr.REPEAT,wrapT:vr.REPEAT},mo=({renderer:e,gltf:t,imageElements:n})=>{const r=new Map,{gl:o}=e;return t.textures&&t.textures.forEach((a,i)=>{const s=Object.assign({},go,void 0===a.sampler?void 0:t.samplers[a.sampler]),u=(({renderer:e,gltf:t,textureId:n})=>{const r=vr.RGBA;for(let e=0;e<t.materials.length;e++){const r=t.materials[e];if(r.emissiveTexture&&r.emissiveTexture.index===n)return 35906;if(r.normalTexture&&r.normalTexture.index===n)return vr.RGBA;if(r.occlusionTexture&&r.occlusionTexture.index===n)return vr.RGBA;if(r.pbrMetallicRoughness){if(r.pbrMetallicRoughness.baseColorTexture&&r.pbrMetallicRoughness.baseColorTexture.index===n)return 35906;if(r.pbrMetallicRoughness.metallicRoughnessTexture&&r.pbrMetallicRoughness.metallicRoughnessTexture.index===n)return vr.RGBA}}return r})({renderer:e,gltf:t,textureId:i}),c=n[a.source],{wrapS:l,wrapT:f,filterMin:E,filterMag:d}=s,_=(({wrapS:e,wrapT:t,filterMin:n,filterMag:r,sampler:o})=>e===vr.REPEAT||e===vr.MIRRORED_REPEAT||t===vr.REPEAT||t===vr.MIRRORED_REPEAT||n===vr.NEAREST_MIPMAP_NEAREST||n===vr.NEAREST_MIPMAP_LINEAR||n===vr.LINEAR_MIPMAP_NEAREST||n===vr.LINEAR_MIPMAP_LINEAR)({wrapS:l,wrapT:f,filterMin:E,filterMag:d,sampler:s})&&!(e=>{const t=e=>0==(e&e-1);return t(e.naturalWidth)&&t(e.naturalHeight)})(c)?(e=>{const t=document.createElement("canvas");return t.width=To(e.width),t.height=To(e.height),t.getContext("2d").drawImage(e,0,0,t.width,t.height),t})(c):c,h=_o({gl:o,format:u,setParameters:()=>{o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,!1),o.pixelStorei(o.UNPACK_COLORSPACE_CONVERSION_WEBGL,o.NONE),o.texParameteri(vr.TEXTURE_2D,o.TEXTURE_WRAP_S,l),o.texParameteri(vr.TEXTURE_2D,o.TEXTURE_WRAP_T,f),o.texParameteri(vr.TEXTURE_2D,o.TEXTURE_MIN_FILTER,E),o.texParameteri(vr.TEXTURE_2D,o.TEXTURE_MAG_FILTER,d)}})(_);r.set(i,h)}),r},Ao=e=>{const t=e.lastIndexOf("/")+1,n=e.lastIndexOf("\\")+1;return t||n?e.substr(0,t>n?t:n):e},Ro=e=>So(e).then(e=>e.arrayBuffer()),Mo=e=>new Promise((t,n)=>{const r=new Image;r.addEventListener("load",()=>t(r)),r.addEventListener("error",n),po(e)||(r.crossOrigin="anonymous"),r.src=e}),po=e=>-1===e.indexOf("http://")&&-1===e.indexOf("https://")||vo(e).origin===window.location.origin,So=e=>((e,t)=>fetch(e,t).then(e=>e.status>=200&&e.status<300?Promise.resolve(e):Promise.reject(e.statusText||e.status)))(e,null),vo=e=>{return new(window.URL||window.webkitURL||window)(e)},No=({gltf:e,coreData:t})=>Promise.resolve(t),Io=({gltf:e,assets:t,renderer:n})=>e=>e,Lo=e=>e=>e=>e,bo=e=>e=>e=>e,Co=e=>e=>e=>e=>e,Oo=e=>e=>e=>e,Po=e=>e=>e=>e,Uo=e=>e=>e,Fo=[{loadAssets:({gltf:e,coreData:t})=>{const n=(e=>e.extensionsUsed&&-1!==e.extensionsUsed.indexOf("PURE3D_IBL")?e.extensions.PURE3D_IBL:null)(e),r=n?n.path:"";return""===r?Promise.resolve(t):(e=>So(e).then(e=>e.json()))(r).then(e=>{const t=Ao(r),n=Array();n.push(e.brdf.url),Object.keys(e.cubeMaps).forEach(t=>{e.cubeMaps[t].urls.forEach(e=>{e.forEach(e=>{n.push(t+"/"+e)})})});const o=n.map(e=>Mo(t+e).then(t=>({url:e,img:t})));return Promise.all(o).then(e=>{const t=new Map;return e.forEach(e=>{t.set(e.url,e.img)}),t}).then(t=>({jsonData:e,imageMap:t}))}).then(e=>Object.assign({},t,{extensions:Object.assign({},t.extensions,{ibl:e})}))},createData:({gltf:e,assets:t,renderer:n})=>e=>{if(!t.extensions.ibl)return e;fo(n);const r=n.gl,{jsonData:o,imageMap:a}=t.extensions.ibl,i=_o({gl:r,format:o.brdf.colorSpace,setParameters:()=>{r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),r.texParameteri(vr.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(vr.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(vr.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(vr.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR)}}),s={brdf:i(a.get(o.brdf.url)),cubeMaps:{},useLod:!1};return Object.keys(o.cubeMaps).forEach(e=>{o.cubeMaps[e].urls.length>1&&(s.useLod=!0),s.cubeMaps[e]=(e=>t=>({colorSpace:n,urls:o})=>{const a=["posX","negX","posY","negY","posZ","negZ"];let i=[];return o.forEach(n=>{const r={};n.forEach((n,o)=>{const i=e.get(t+"/"+n);r[a[o]]=i}),i.push(r)}),ho({gl:r,format:n,setParameters:e=>{r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),o.length>1?(r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,r.LINEAR)):(r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,r.LINEAR))}})(i)})(a)(e)(o.cubeMaps[e])}),Object.assign({},e,{extensions:Object.assign({},e.extensions,{ibl:s})})},createScene:Lo,createNode:bo,initialShaderConfig_Primitive:Co,runtimeShaderConfig_Primitive:Oo,initialShaderConfig_Scene:e=>t=>t=>e.extensions.ibl?Object.assign({},t,{ibl:{useLod:e.extensions.ibl.useLod}}):t,runtimeShaderConfig_Scene:Uo,getShaderSource:e=>t=>t=>t=>{if(e.extensions.ibl){const n=[];n.push("USE_IBL"),e.extensions.ibl.useLod&&n.push("USE_TEX_LOD");const r=n.map(e=>`#define ${e} 1\n`).join("");return Object.assign({},t,{vertex:r+t.vertex,fragment:r+t.fragment})}return t}},{loadAssets:No,createData:Io,createScene:Lo,createNode:e=>t=>n=>{const r=(e=>e.extensionsUsed&&-1!==e.extensionsUsed.indexOf("KHR_lights_punctual")?e.extensions.KHR_lights_punctual.lights:null)(e),o=t.extensions&&t.extensions.hasOwnProperty("KHR_lights_punctual")?t.extensions.KHR_lights_punctual:void 0;if(!r||!o)return n;const a=(e=>{const t={kind:{directional:Sr.Directional,point:Sr.Point,spot:Sr.Spot}[e.type],color:e.color?Float64Array.from(e.color):Float64Array.from([1,1,1]),intensity:void 0!==e.intensity?e.intensity:1};if(t.kind===Sr.Spot){const n=e.spot&&void 0!==e.spot.innerConeAngle?e.spot.innerConeAngle:0,r=e.spot&&void 0!==e.spot.outerConeAngle?e.spot.outerConeAngle:Math.PI/4;t.angleScale=1/Math.max(.001,Math.cos(n)-Math.cos(r)),t.angleOffset=-Math.cos(r)*t.angleScale}return t.kind!==Sr.Point&&t.kind!==Sr.Spot||(t.range=e.range?e.range:0),t})(r[o.light]);if(n.kind)throw new Error("node cannot be both a light and some other kind...");return Object.assign({},n,{kind:pr.LIGHT,light:a})},initialShaderConfig_Primitive:Co,runtimeShaderConfig_Primitive:Oo,initialShaderConfig_Scene:Po,runtimeShaderConfig_Scene:e=>t=>{let n=0,r=0,o=0;Gr(e=>{if(e.kind===pr.LIGHT)switch(e.light.kind){case Sr.Directional:r++;break;case Sr.Point:n++;break;case Sr.Spot:o++}})(e.nodes);const a={nPointLights:n,nDirectionalLights:r,nSpotLights:o};return Object.assign({},t,{lights:a})},getShaderSource:e=>e=>t=>n=>{if(e.lights){const r=[],{nPointLights:o,nDirectionalLights:a,nSpotLights:i}=e.lights;if((o>10||a>10||i>10)&&console.warn("Only 10 lights of each kind are supported"),!o&&!a&&!i)return n;r.push("USE_PUNCTUAL_LIGHTS");const s=r.map(e=>`#define ${e} 1\n`).join("");return Object.assign({},n,{vertex:s+n.vertex,fragment:(e=>t=>t=>{let n="",r="";const o=e.lights.nDirectionalLights,a=e.lights.nPointLights,i=e.lights.nSpotLights;if(o){n+=`uniform vec3 u_Light_Directional_Direction[${o}];\n`,n+=`uniform vec3 u_Light_Directional_Color[${o}];\n`,n+=`uniform float u_Light_Directional_Intensity[${o}];\n`;for(let e=0;e<o;e++)r+=`light = getDirectionalLight(\n                fragment,\n                u_Light_Directional_Direction[${e}],\n                u_Light_Directional_Color[${e}],\n                u_Light_Directional_Intensity[${e}]\n            );\n`,r+="color += getLightColor(pbr, fragment, light);\n"}if(a){n+=`uniform vec3 u_Light_Point_Position[${a}];\n`,n+=`uniform vec3 u_Light_Point_Color[${a}];\n`,n+=`uniform float u_Light_Point_Intensity[${a}];\n`,n+=`uniform float u_Light_Point_Range[${a}];\n`;for(let e=0;e<a;e++)r+=`light = getPointLight(\n                fragment,\n                u_Light_Point_Position[${e}], \n                u_Light_Point_Color[${e}], \n                u_Light_Point_Intensity[${e}],\n                u_Light_Point_Range[${e}]\n            );\n`,r+="color += getLightColor(pbr, fragment, light);\n"}if(i){n+=`uniform vec3 u_Light_Spot_Position[${i}];\n`,n+=`uniform vec3 u_Light_Spot_Direction[${i}];\n`,n+=`uniform float u_Light_Spot_AngleScale[${i}];\n`,n+=`uniform float u_Light_Spot_AngleOffset[${i}];\n`,n+=`uniform vec3 u_Light_Spot_Color[${i}];\n`,n+=`uniform float u_Light_Spot_Intensity[${i}];\n`,n+=`uniform float u_Light_Spot_Range[${i}];\n`;for(let e=0;e<i;e++)r+=`light = getSpotLight(\n                fragment,\n                u_Light_Spot_Position[${e}], \n                u_Light_Spot_Direction[${e}], \n                u_Light_Spot_AngleScale[${e}], \n                u_Light_Spot_AngleOffset[${e}], \n                u_Light_Spot_Color[${e}], \n                u_Light_Spot_Intensity[${e}],\n                u_Light_Spot_Range[${e}]\n            );\n`,r+="color += getLightColor(pbr, fragment, light);\n"}return t.replace("%PUNCTUAL_LIGHTS_VARS%",n).replace("%PUNCTUAL_LIGHTS_FUNCS%",r)})(e)(t)(s+n.fragment)})}return n}},{loadAssets:No,createData:Io,createScene:Lo,createNode:bo,initialShaderConfig_Primitive:e=>t=>n=>n=>{const r=(e=>t=>n=>{const r=e.original.meshes[t];return r?r.primitives[n]:void 0})(e)(t.meshId)(t.primitiveId);if(null==r.material)return n;const o=e.original,a=e.original.materials[r.material];return null==a.extensions?n:o.extensionsUsed&&-1!==o.extensionsUsed.indexOf("KHR_materials_unlit")&&-1!==Object.keys(a.extensions).indexOf("KHR_materials_unlit")?Object.assign({},n,{unlit:!0}):n},runtimeShaderConfig_Primitive:Oo,initialShaderConfig_Scene:Po,runtimeShaderConfig_Scene:Uo,getShaderSource:e=>e=>e=>t=>{if(e.unlit){console.log("UNLIT!");const e=["UNLIT"].map(e=>`#define ${e} 1\n`).join("");return Object.assign({},t,{vertex:e+t.vertex,fragment:e+t.fragment})}return t}}],yo=({basePath:e,gltf:t,buffers:n})=>{return Promise.all(t.images&&t.images.length?t.images.map(r=>void 0!==r.bufferView?(({data:e,mimeType:t})=>new Promise((n,r)=>{const o=new Image;o.addEventListener("load",()=>n(o)),o.addEventListener("error",r);const a=new Uint8Array(e),i=new Blob([a],{type:t}),s=window.URL||window.webkitURL;o.src=s.createObjectURL(i)}))({data:(e=>{const r=t.bufferViews[e],o=r.buffer,a=void 0===r.byteOffset?0:r.byteOffset;return n[o].slice(a,a+r.byteLength)})(r.bufferView),mimeType:r.mimeType}):0===r.uri.indexOf("data:")?Mo(r.uri):Mo(e+r.uri)):[])},xo=({basePath:e,gltf:t,glbBuffers:n})=>Fo.map(e=>e.loadAssets).reduce((e,n)=>(e=e.then(e=>n({gltf:t,coreData:e})),e),(({basePath:e,gltf:t,glbBuffers:n})=>Promise.all(t.buffers.map((t,r)=>void 0!==n&&r<n.length?Promise.resolve(n[r].slice(0,t.byteLength)):0===t.uri.indexOf("data:")?Ro(t.uri):Ro(e+t.uri))))({basePath:e,gltf:t,glbBuffers:n}).then(n=>yo({basePath:e,gltf:t,buffers:n}).then(e=>({buffers:n,imageElements:e,extensions:{}})))),wo=({gltf:e,assets:t,renderer:n,config:r})=>{fo(n);const{imageElements:o,buffers:a}=t,i=mo({renderer:n,gltf:e,imageElements:o}),s=co({gltf:e,buffers:a,renderer:n}),u=(({gltf:e,buffers:t})=>{const n=new Map;let r=0;return e.animations&&e.animations.forEach(o=>{o.channels.filter(e=>void 0!==e.target.node).forEach(a=>{const i=ao[a.target.path.toLowerCase()],s=o.samplers[a.sampler],u=io[s.interpolation?s.interpolation.toLowerCase():"linear"],c=e.accessors[s.input],l=no({gltf:e,buffers:t,info:ro({gltf:e,accessorId:s.input})}),f=no({gltf:e,buffers:t,info:ro({gltf:e,accessorId:s.output})}),E=e.accessors[s.output];let d=new Array(l.length);l.forEach((e,t)=>{const n=i===ur.WEIGHTS?f.length/l.length:Qr[E.type];d[t]={timing:e,values:1===n?f[t]:f.subarray(t*n,(t+1)*n)}}),n.set(r++,{keyframes:d,interpolation:u,targetPath:i,timeMin:c.min[0],timeMax:c.max[0]})})}),n})({gltf:e,buffers:a}),c=new Map;return Fo.map(e=>e.createData).reduce((r,o)=>(r=o({gltf:e,assets:t,renderer:n})(r),r),{original:e,animations:u,attributes:s,textures:i,shaders:c,initConfig:r,extensions:{}})},Bo=(Do=new Array(128),Ho=String.fromCodePoint||String.fromCharCode,Vo=[],function(e){var t,n,r=e.length;Vo.length=0;for(var o=0;o<r;)(n=e[o++])<=127?t=n:n<=223?t=(31&n)<<6|63&e[o++]:n<=239?t=(15&n)<<12|(63&e[o++])<<6|63&e[o++]:String.fromCodePoint?t=(7&n)<<18|(63&e[o++])<<12|(63&e[o++])<<6|63&e[o++]:(t=63,o+=3),Vo.push(Do[t]||(Do[t]=Ho(t)));return Vo.join("")});var Do,Ho,Vo;const Go=e=>{const t=new Uint8Array(e),n=window.TextDecoder?new TextDecoder("utf-8").decode(t):Bo(t);return JSON.parse(n)},Xo=e=>t=>{const n=new DataView(t,e,8),r=n.getUint32(0,!0),o=n.getUint32(4,!0),a=e+8,i=a+r,s=t.slice(a,i),u=[1313821514===o?Go(s):5130562===o?s:null,i];return null===u[0]&&console.log(`unknown chunk type: ${o}`),u},ko=e=>1179937895===(e=>{const t=new DataView(e,0,12);return{magic:t.getUint32(0,!0),version:t.getUint32(4,!0),length:t.getUint32(8,!0)}})(e).magic,Wo=e=>ko(e)?(e=>{const[t,n]=Xo(12)(e),r=new Array;let o=n;for(;o<e.byteLength;){const[t,n]=Xo(o)(e);null!==t&&r.push(t),o+=n}return{gltf:t,glbBuffers:r}})(e):{gltf:Go(e),glbBuffers:[]};let jo=0;const Yo={POSITION:"a_Position",NORMAL:"a_Normal",TANGENT:"a_Tangent",TEXCOORD_0:"a_UV",COLOR_0:"a_Color",JOINTS_0:"a_Skin_Joint",WEIGHTS_0:"a_Skin_Weight"},qo=e=>e.sort((e,t)=>{if(e===t)return 0;const n=["POSITION","NORMAL","TANGENT","TEXCOOR_0","COLOR_0","JOINTS_0","WEIGHTS_0"],r=n.indexOf(e),o=n.indexOf(t);return r<o?-1:r>o?1:0}),Ko=e=>qo(Object.keys(e.attributes)),zo=e=>t=>n=>{e.original;const r=e.original.nodes[t.nodeId],o=e.original.meshes[t.meshId].primitives[t.primitiveId],a=e=>t=>-1!==Object.keys(e.attributes).indexOf(t),i=n.material;let s=0,u=0,c=0,l=0,f=0;if(void 0!==r.skin){f=e.original.skins[r.skin].joints.length}return o.targets&&o.targets.forEach(e=>{qo(Object.keys(e)).forEach(e=>{switch(e){case"POSITION":u++;break;case"NORMAL":c++;break;case"TANGENT":l++;break;default:console.warn("unknown...",e)}}),s++}),{nMorphWeights:s,nPositionMorphs:u,nNormalMorphs:c,nTangentMorphs:l,nSkinJoints:f,alphaMode:i&&i.alphaMode?i.alphaMode:lr.OPAQUE,hasNormalAttributes:a(o)("NORMAL"),hasTangentAttributes:a(o)("TANGENT"),hasUvAttributes:a(o)("TEXCOORD_0"),hasColorAttributes:a(o)("COLOR_0"),hasBaseColorMap:i&&void 0!==i.baseColorSamplerIndex,hasNormalMap:i&&void 0!==i.normal,hasEmissiveMap:i&&void 0!==i.emissiveSamplerIndex,hasMetalRoughnessMap:i&&void 0!==i.metallicRoughnessSamplerIndex,hasOcclusionMap:i&&void 0!==i.occlusion,manualSRGB:!0===e.initConfig.manualSRGB,fastSRGB:!0===e.initConfig.fastSRGB,unlit:!1}},$o=({renderer:e,data:t})=>{const n=t.original,r=new Map;return void 0===n.nodes||null===n.nodes?r:(n.nodes.map((e,t)=>[e,t]).filter(([e,t])=>void 0!==e.mesh&&null!==e.mesh).forEach(([o,a])=>r.set(o.mesh,n.meshes[o.mesh].primitives.map((r,i)=>{n.meshes[o.mesh];const s=Object.assign({vaoId:(({renderer:e,originalPrimitive:t,data:n})=>{const r={data:[]},o=n.attributes.accessorLookup;void 0!==t.indices&&(r.elementBufferId=o.get(t.indices).rendererBufferId),Ko(t).forEach(n=>{const a=t.attributes[n],i=Yo[n];if(!o.has(a))throw new Error("bug here!");r.data.push(Object.assign({location:e.attributes.getLocationInRenderer(i),bufferId:o.get(a).rendererBufferId},o.get(a).strategy))});const{targets:a}=t;if(a){let t=0;a.forEach(n=>{qo(Object.keys(n)).forEach(a=>{const i=n[a],s=`a_Morph_${t++}`;r.data.push(Object.assign({location:e.attributes.getLocationInRenderer(s),bufferId:o.get(i).rendererBufferId},o.get(i).strategy))})})}const i=jo++,s=Symbol();return n.attributes.vaoIdLookup.set(i,s),e.vertexArrays.assign(s)(r),i})({renderer:e,originalPrimitive:r,data:t})},(({originalPrimitive:e,data:t})=>{const n={drawKind:void 0!==e.indices?Er.ELEMENTS:Er.ARRAY,drawMode:e.mode?e.mode:vr.TRIANGLES};if(n.drawKind===Er.ELEMENTS)n.elementsId=e.indices;else{const r=Ko(e);n.arrayCount=t.original.accessors[e.attributes[r[0]]].count}return n})({originalPrimitive:r,data:t}));return void 0!==r.material&&(s.material=(({gltf:e,materialId:t,data:n})=>{const r=e.materials[t],o={};if(o.metallicRoughnessValues=Float64Array.from([1,1]),o.baseColorFactor=Float64Array.from([1,1,1,1]),r.pbrMetallicRoughness&&(void 0!==r.pbrMetallicRoughness.metallicFactor&&(o.metallicRoughnessValues[0]=r.pbrMetallicRoughness.metallicFactor),void 0!==r.pbrMetallicRoughness.roughnessFactor&&(o.metallicRoughnessValues[1]=r.pbrMetallicRoughness.roughnessFactor),void 0!==r.pbrMetallicRoughness.baseColorFactor&&(o.baseColorFactor=Float64Array.from(r.pbrMetallicRoughness.baseColorFactor)),void 0!==r.pbrMetallicRoughness.baseColorTexture&&(o.baseColorSamplerIndex=r.pbrMetallicRoughness.baseColorTexture.index),void 0!==r.pbrMetallicRoughness.metallicRoughnessTexture&&(o.metallicRoughnessSamplerIndex=r.pbrMetallicRoughness.metallicRoughnessTexture.index)),void 0!==r.normalTexture){const e=void 0!==r.normalTexture.scale?r.normalTexture.scale:1;o.normal={scale:e,samplerIndex:r.normalTexture.index}}if(void 0!==r.occlusionTexture){const e=void 0!==r.occlusionTexture.strength?r.occlusionTexture.strength:1;o.occlusion={strength:e,samplerIndex:r.occlusionTexture.index}}if(void 0!==r.emissiveTexture&&(o.emissiveSamplerIndex=r.emissiveTexture.index),void 0!==r.emissiveFactor&&(o.emissiveFactor=Float64Array.from(r.emissiveFactor)),r.alphaMode)switch(r.alphaMode){case"BLEND":o.alphaMode=lr.BLEND;break;case"MASK":o.alphaMode=lr.MASK;break;default:o.alphaMode=lr.OPAQUE}return o.doubleSided=!!r.doubleSided,o.alphaCutoff=void 0===r.alphaCutoff?.5:r.alphaCutoff,o})({gltf:n,materialId:r.material,data:t})),s.shaderConfig=(e=>t=>n=>Fo.map(e=>e.initialShaderConfig_Primitive).reduce((r,o)=>(r=o(e)(t)(n)(r),r),zo(e)(t)(n)))(t)({nodeId:a,meshId:o.mesh,primitiveId:i})(s),s}))),r)},Zo=({renderer:e,data:t,allNodes:n})=>e=>{let r=[];if(e>=0&&t.original.scenes[e]){const o=t.original.scenes[e].nodes;Gr(e=>{-1!==o.indexOf(e.originalNodeId)&&r.push(e)})(n)}else r=n,console.warn("no scene specified! Expect duplicate nodes...");const o=e>=0?t.original.scenes[e]:{nodes:t.original.nodes.map((e,t)=>t)},a=Fo.map(e=>e.createScene).reduce((e,n)=>e=n(t.original)(o)(e),{nodes:r});return a.shaderConfig=(e=>t=>Fo.map(e=>e.initialShaderConfig_Scene).reduce((n,r)=>(n=r(e)(t)(n),n),{}))(t)(a),a},Qo=({gltf:e,buffers:t})=>{const n=new Map;if(!e.skins||!e.skins.length)return n;return e.skins.forEach((r,o)=>{const a=r.inverseBindMatrices?(e=>{const t=new Array;for(let n=0;n<e.length;)t.push(e.slice(n,n+16)),n+=16;return t})(no({gltf:e,buffers:t,info:ro({gltf:e,accessorId:r.inverseBindMatrices})})):r.joints.map(Ir);if(a.length!==r.joints.length)throw new Error("inverse bind matrices mismatch!");let i;const s={joints:r.joints.map((e,t)=>{const n={originalNodeId:e,inverseBindMatrix:a[t]};return void 0!==r.skeleton&&r.skeleton===e&&(i=e),n})};void 0!==i&&(s.skeletonRootId=i),n.set(o,s)}),n},Jo=({gltf:e,primitives:t,data:n,assets:r})=>{const o=Qo({gltf:e,buffers:r.buffers}),a=n=>r=>i=>{const s={originalNodeId:r,kind:void 0!==i.mesh&&t.has(i.mesh)&&t.get(i.mesh).length?fr.MESH:void 0!==i.camera?pr.CAMERA:void 0},u=i.matrix?Or(Float64Array.from(i.matrix)):function(e){const t={translation:Float64Array.from([0,0,0]),rotation:Float64Array.from([0,0,0,1]),scale:Float64Array.from([1,1,1])};return Object.keys(t).forEach(n=>{const r=e[n];r&&(t[n]=r)}),t}(i),c=i.matrix?new Float64Array(i.matrix):Pr(u),l=Ur(n)(c);if(s.transform={trs:u,localMatrix:c,modelMatrix:l},s.kind===fr.MESH&&e.meshes[i.mesh].primitives.some(e=>(e=>t=>-1!==Object.keys(t.attributes).indexOf(e))("NORMAL")(e))&&(s.transform.normalMatrix=Fr(l)),s.kind===fr.MESH){if(s.primitives=t.get(i.mesh),void 0!==i.skin){const e=o.get(i.skin);s.skin={skinId:i.skin,joints:e.joints.slice()},void 0!==e.skeletonRootId&&(s.skin.skeletonRootId=e.skeletonRootId)}const n=i.weights?Float64Array.from(i.weights):e.meshes[i.mesh].weights?Float64Array.from(e.meshes[i.mesh].weights):void 0;n&&(s.morphWeights=n)}else s.kind===pr.CAMERA&&(s.camera={settings:(e=>"orthographic"===e.type?{kind:Mr.ORTHOGRAPHIC,xmag:e.orthographic.xmag,ymag:e.orthographic.ymag,znear:e.orthographic.znear,zfar:e.orthographic.zfar}:{kind:Mr.PERSPECTIVE,aspectRatio:e.perspective.aspectRatio,yfov:e.perspective.yfov,znear:e.perspective.znear,zfar:e.perspective.zfar})(e.cameras[i.camera])},s.cameraIndex=i.camera);const f=Fo.map(e=>e.createNode).reduce((t,n)=>(t=n(e)(i)(t),t),s);return i.children?Object.assign({},f,{children:i.children.map(t=>a(l)(t)(e.nodes[t]))}):f};return(({gltf:e,nodes:t})=>{let n=0;return e.animations&&e.animations.forEach(e=>{e.channels.filter(e=>void 0!==e.target.node).forEach(e=>{Kr(t=>(t.originalNodeId===e.target.node&&(t.animationIds&&-1!==t.animationIds.indexOf(n)||(t.animationIds||(t.animationIds=[]),t.animationIds.push(n))),t))(t),n++})}),t})({gltf:e,nodes:e.nodes.map((e,t)=>a(null)(t)(e))})};var ea;!function(e){e[e.FLOAT=0]="FLOAT",e[e.INT=1]="INT"}(ea||(ea={}));let ta;const na=new Map,ra=({renderer:e,source:t})=>{let n,r;const{gl:o}=e,a=o.createProgram(),i=()=>{void 0!==n&&n instanceof WebGLShader&&o.deleteShader(n),void 0!==r&&r instanceof WebGLShader&&o.deleteShader(r),o.deleteProgram(a)},s=e=>t=>{const n=o.createShader(e);if(o.shaderSource(n,t),o.compileShader(n),!o.getShaderParameter(n,o.COMPILE_STATUS)){const t=`${(e=>e===o.VERTEX_SHADER?"vertex":"fragment")(e)} error: `+o.getShaderInfoLog(n);throw new Error(t)}return o.attachShader(a,n),n};if((n=s(o.VERTEX_SHADER)(t.vertex))instanceof Error)return i(),n;if((r=s(o.FRAGMENT_SHADER)(t.fragment))instanceof Error)return i(),r;let u=0;return e.attributes.globalLocations.forEach(e=>{o.bindAttribLocation(a,u,e),u++}),o.linkProgram(a),o.getProgramParameter(a,o.LINK_STATUS)?a:(i(),new Error("Unable to initialize the shader program: "+o.getProgramInfoLog(a)))},oa=e=>(ta&&ta.shaderId===e||(ta=na.get(e)).gl.useProgram(ta.program),ta),aa=e=>oa(e),ia=({renderer:e,shaderId:t,source:n})=>{const r=ra({source:n,renderer:e}),o={gl:e.gl,shaderId:t,program:r,uniforms:(({renderer:e,activateShader:t})=>{const{gl:n}=e,r={uniformLocations:new Map,uniformValues:new Map,uniformSingleValues:new Map,uniformMatrixTranspose:new Map},o=e=>{const{program:o}=t();return r.uniformLocations.has(e)||r.uniformLocations.set(e,n.getUniformLocation(o,e)),r.uniformLocations.get(e)},a=e=>null!=e&&-1!=e,i=e=>t=>{if(!r.uniformValues.has(e))return!1;const n=r.uniformValues.get(e);if(n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==t[e])return!1;return!0},s=e=>t=>n=>{if(!r.uniformValues.has(t)){switch(e){case ea.FLOAT:r.uniformValues.set(t,new Float32Array(n.length));break;case ea.INT:r.uniformValues.set(t,new Int32Array(n.length))}return}const o=r.uniformValues.get(t);for(let e=0;e<n.length;e++)o[e]=n[e]},u=e=>t=>n=>{if(!r.uniformSingleValues.has(t)||r.uniformSingleValues.get(t)!==n){r.uniformSingleValues.set(t,n);const i=o(t);a(i)&&e(i)(n)}},c=e=>t=>n=>u=>{if(!i(n)(u)){s(e)(n)(u);const i=o(n);a(i)&&t(i)(r.uniformValues.get(n))}},l=e=>t=>n=>u=>c=>{if(!r.uniformMatrixTranspose.has(n)||r.uniformMatrixTranspose.get(n)!==u||!i(n)(c)){s(e)(n)(c),r.uniformMatrixTranspose.set(n,u);const i=o(n);a(i)&&t(i)(u)(r.uniformValues.get(n))}},f={uniform1f:u(e=>t=>n.uniform1f(e,t)),uniform1fv:c(ea.FLOAT)(e=>t=>n.uniform1fv(e,t)),uniform1i:u(e=>t=>n.uniform1i(e,t)),uniform1iv:c(ea.INT)(e=>t=>n.uniform1iv(e,t)),uniform2f:c(ea.FLOAT)(e=>t=>n.uniform2f(e,t[0],t[1])),uniform2fv:c(ea.FLOAT)(e=>t=>n.uniform2fv(e,t)),uniform2i:c(ea.INT)(e=>t=>n.uniform2i(e,t[0],t[1])),uniform2iv:c(ea.INT)(e=>t=>n.uniform2iv(e,t)),uniform3f:c(ea.FLOAT)(e=>t=>n.uniform3f(e,t[0],t[1],t[2])),uniform3fv:c(ea.FLOAT)(e=>t=>n.uniform3fv(e,t)),uniform3i:c(ea.INT)(e=>t=>n.uniform3i(e,t[0],t[1],t[2])),uniform3iv:c(ea.INT)(e=>t=>n.uniform3iv(e,t)),uniform4f:c(ea.FLOAT)(e=>t=>n.uniform4f(e,t[0],t[1],t[2],t[3])),uniform4fv:c(ea.FLOAT)(e=>t=>n.uniform4fv(e,t)),uniform4i:c(ea.INT)(e=>t=>n.uniform4i(e,t[0],t[1],t[2],t[3])),uniform4iv:c(ea.INT)(e=>t=>n.uniform4iv(e,t)),uniformMatrix2fv:l(ea.FLOAT)(e=>t=>r=>n.uniformMatrix2fv(e,t,r)),uniformMatrix3fv:l(ea.FLOAT)(e=>t=>r=>n.uniformMatrix3fv(e,t,r)),uniformMatrix4fv:l(ea.FLOAT)(e=>t=>r=>n.uniformMatrix4fv(e,t,r))};return{cache:r,setters:f,getLocation:o,validLocation:a,hasLocation:e=>a(o(e))}})({renderer:e,activateShader:()=>oa(t)})};return na.set(t,o),o},sa=new Uint8Array(19),ua=new Uint8Array(30),ca=new Uint8Array(30),la=new Uint8Array(30),fa=e=>{let t=1<<e.length;for(let n=0;n<e.length;n++)t|=e[n]<<e.length-n-1;return t};var Ea="#define PI 3.1415926535897932384626433832795\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\n\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n",da="%MORPH_VARS%\n\n#ifdef HAS_SKIN\nattribute vec4 a_Skin_Joint;\nattribute vec4 a_Skin_Weight;\nuniform mat4 u_Skin_Matrices[%SKIN_JOINT_COUNT%];\n#endif\n\nattribute vec4 a_Position;\n#ifdef HAS_NORMALS\nattribute vec4 a_Normal;\n#endif\n#ifdef HAS_TANGENTS\nattribute vec4 a_Tangent;\n#endif\n#ifdef HAS_UV\nattribute vec2 a_UV;\n#endif\n#ifdef HAS_COLOR\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n#endif\n\nuniform mat4 u_MVPMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_NormalMatrix;\n\nvarying vec3 v_Position;\nvarying vec2 v_UV;\n\n#ifdef HAS_NORMALS\n#ifdef HAS_TANGENTS\nvarying mat3 v_TBN;\n#else\nvarying vec3 v_Normal;\n#endif\n#endif\n\n\nvoid main()\n{\n\n  \n\n  vec4 m_Position = a_Position;\n  #ifdef HAS_NORMALS\n    vec4 m_Normal = a_Normal;\n  #endif\n  #ifdef HAS_TANGENTS\n    vec4 m_Tangent = a_Tangent;\n  #endif\n\n#ifdef HAS_SKIN\n    mat4 skinMat = a_Skin_Weight[0] * u_Skin_Matrices[int(a_Skin_Joint[0])]\n        +   a_Skin_Weight[1] * u_Skin_Matrices[int(a_Skin_Joint[1])]\n        +   a_Skin_Weight[2] * u_Skin_Matrices[int(a_Skin_Joint[2])]\n        +   a_Skin_Weight[3] * u_Skin_Matrices[int(a_Skin_Joint[3])];\n\n    m_Position = skinMat * m_Position;\n#endif\n    %MORPH_FUNCS%\n\n\n  \n  vec4 pos = u_ModelMatrix * m_Position;\n  v_Position = vec3(pos.xyz) / pos.w;\n\n  #ifdef HAS_NORMALS\n  #ifdef HAS_TANGENTS\n  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(m_Normal.xyz, 0.0)));\n  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(m_Tangent.xyz, 0.0)));\n  vec3 bitangentW = cross(normalW, tangentW) * m_Tangent.w;\n  v_TBN = mat3(tangentW, bitangentW, normalW);\n  #else // HAS_TANGENTS != 1\n  v_Normal = normalize(vec3(u_ModelMatrix * vec4(m_Normal.xyz, 0.0)));\n  #endif\n  #endif\n\n  #ifdef HAS_UV\n  v_UV = a_UV;\n  #else\n  v_UV = vec2(0.,0.);\n  #endif\n\n    #ifdef HAS_COLOR\n    v_Color = a_Color;\n    #endif\n\n\n  gl_Position = u_MVPMatrix * m_Position; // needs w for proper perspective correction\n}\n\n",_a="precision highp float;\nprecision highp int;\n",ha="precision highp float;\nprecision highp int;\n\n#extension GL_EXT_shader_texture_lod: enable\n#extension GL_OES_standard_derivatives : enable\n\nuniform vec3 u_Camera;\n\nvarying vec3 v_Position;\nvarying vec2 v_UV;\n\n#ifdef HAS_NORMALS\n    #ifdef HAS_TANGENTS\n        varying mat3 v_TBN;\n    #else\n        varying vec3 v_Normal;\n    #endif\n#endif\n\n#ifdef HAS_NORMALMAP\n    uniform sampler2D u_NormalSampler;\n    uniform float u_NormalScale;\n#endif\n\nstruct Fragment \n{\n    vec3 normal; // fragment normal\n    vec3 vectorToCamera; //normalized vector from surface point to camera\n    vec3 reflection; //reflection vector\n    float NdotV; // cos angle between normal and view direction\n};\n\nvec3 getNormal()\n{\n    // Retrieve the tangent space matrix\n    #ifndef HAS_TANGENTS\n    vec3 pos_dx = dFdx(v_Position);\n    vec3 pos_dy = dFdy(v_Position);\n    vec3 tex_dx = dFdx(vec3(v_UV, 0.0));\n    vec3 tex_dy = dFdy(vec3(v_UV, 0.0));\n    vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\n\n    #ifdef HAS_NORMALS\n    vec3 ng = normalize(v_Normal);\n    #else\n    vec3 ng = cross(pos_dx, pos_dy);\n    #endif\n\n    t = normalize(t - ng * dot(ng, t));\n    vec3 b = normalize(cross(ng, t));\n    mat3 tbn = mat3(t, b, ng);\n    #else // HAS_TANGENTS\n    mat3 tbn = v_TBN;\n    #endif\n\n    #ifdef HAS_NORMALMAP\n    vec3 n = texture2D(u_NormalSampler, v_UV).rgb;\n    n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));\n    #else\n    // The tbn matrix is linearly interpolated, so we need to re-normalize\n    vec3 n = normalize(tbn[2].xyz);\n    #endif\n\n    return n;\n}\n\n//Get Fragment info\nFragment getFragment() {\n    vec3 normal = getNormal();\n    vec3 vectorToCamera = normalize(u_Camera - v_Position); \n    vec3 reflection = -normalize(reflect(vectorToCamera, normal));\n    float NdotV = abs(dot(normal, vectorToCamera)) + 0.001;\n    return Fragment(normal, vectorToCamera, reflection, NdotV);\n}\n",Ta="vec4 SRGBtoLINEAR(vec4 srgbIn)\n{\n    #ifdef MANUAL_SRGB\n        #ifdef SRGB_FAST_APPROXIMATION\n            vec3 linOut = pow(srgbIn.xyz,vec3(2.2));\n        #else //SRGB_FAST_APPROXIMATION\n            vec3 bLess = step(vec3(0.04045),srgbIn.xyz);\n            vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );\n        #endif //SRGB_FAST_APPROXIMATION\n        \n        return vec4(linOut,srgbIn.w);\n    #else //MANUAL_SRGB\n        return srgbIn;\n    #endif //MANUAL_SRGB\n}\n",ga="const float c_MinRoughness = 0.04;\n\n#ifdef HAS_BASECOLORMAP\n    uniform sampler2D u_BaseColorSampler;\n    uniform float u_AlphaCutoff; \n#endif\n\n\n#ifdef HAS_EMISSIVEMAP\n    uniform sampler2D u_EmissiveSampler;\n    uniform vec3 u_EmissiveFactor;\n#endif\n\n#ifdef HAS_METALROUGHNESSMAP\n    uniform sampler2D u_MetallicRoughnessSampler;\n#endif\n\n#ifdef HAS_OCCLUSIONMAP\n    uniform sampler2D u_OcclusionSampler;\n    uniform float u_OcclusionStrength;\n#endif\n\n#ifdef HAS_COLOR\n    varying vec4 v_Color;\n#endif\n\nuniform vec2 u_MetallicRoughnessValues;\nuniform vec4 u_BaseColorFactor;\n\nstruct Pbr \n{\n    vec4 baseColor;\n    float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)\n    float metalness;              // metallic value at the surface\n    vec3 reflectance0;            // full reflectance color (normal incidence angle)\n    vec3 reflectance90;           // reflectance color at grazing angle\n    float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])\n    vec3 diffuseColor;            // color contribution from diffuse lighting\n    vec3 specularColor;           // color contribution from specular lighting\n};\n\nvec4 getBaseColor() {\n    // The albedo may be defined from a base texture or a flat color\n    #ifdef HAS_BASECOLORMAP\n        vec4 textureColor = texture2D(u_BaseColorSampler, v_UV);\n        vec4 baseColor = SRGBtoLINEAR(textureColor) * u_BaseColorFactor;\n    #else\n        vec4 baseColor = u_BaseColorFactor;\n    #endif\n\n    return baseColor;\n}\n\nPbr getPbr() {\n    // Metallic and Roughness material properties are packed together\n    // In glTF, these factors can be specified by fixed scalar values\n    // or from a metallic-roughness map\n    float perceptualRoughness = u_MetallicRoughnessValues.y;\n    float metallic = u_MetallicRoughnessValues.x;\n    #ifdef HAS_METALROUGHNESSMAP\n    // Roughness is stored in the 'g' channel, metallic is stored in the 'b' channel.\n    // This layout intentionally reserves the 'r' channel for (optional) occlusion map data\n    vec4 mrSample = texture2D(u_MetallicRoughnessSampler, v_UV);\n    perceptualRoughness = mrSample.g * perceptualRoughness;\n    metallic = mrSample.b * metallic;\n    #endif\n    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);\n    metallic = clamp(metallic, 0.0, 1.0);\n    // Roughness is authored as perceptual roughness; as is convention,\n    // convert to material roughness by squaring the perceptual roughness [2].\n    float alphaRoughness = perceptualRoughness * perceptualRoughness;\n\n    vec4 baseColor = getBaseColor();\n\n    #ifdef HAS_ALPHA_CUTOFF\n    if(baseColor.a < u_AlphaCutoff) {\n        discard;\n    }\n\n    #endif\n\n    #ifndef HAS_ALPHA_BLEND\n    baseColor.a = 1.0;\n    #endif\n\n    vec3 f0 = vec3(0.04);\n    #ifdef HAS_COLOR\n    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0) * SRGBtoLINEAR(v_Color).rgb;\n    diffuseColor *= 1.0 - metallic;\n    #else\n    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);\n    diffuseColor *= 1.0 - metallic;\n    #endif\n    vec3 specularColor = mix(f0, baseColor.rgb, metallic);\n\n    // Compute reflectance.\n    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);\n\n    // For typical incident reflectance range (between 4% to 100%) set the grazing reflectance to 100% for typical fresnel effect.\n    // For very low reflectance range on highly diffuse objects (below 4%), incrementally reduce grazing reflecance to 0%.\n    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);\n    vec3 specularEnvironmentR0 = specularColor.rgb;\n    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;\n\n    return Pbr(\n            baseColor,\n            perceptualRoughness,\n            metallic,\n            specularEnvironmentR0,\n            specularEnvironmentR90,\n            alphaRoughness,\n            diffuseColor,\n            specularColor\n    );\n}\n\n",ma='#ifdef USE_PUNCTUAL_LIGHTS\n%PUNCTUAL_LIGHTS_VARS%\n\nstruct Light\n{\n    float NdotL;                  // cos angle between normal and light direction\n    float NdotH;                  // cos angle between normal and half vector\n    float LdotH;                  // cos angle between light direction and half vector\n    float VdotH;                  // cos angle between view direction and half vector\n    vec3 color;                   \n    float falloff;               \n    float intensity;\n};\n\n//from https://github.com/mrdoob/three.js/blob/dev/src/renderers/shaders/ShaderChunk/bsdfs.glsl\n//decay of 2.0 is for physically correct\nfloat getFalloff(float lightDistance, float cutoffDistance, float decay) {\n    float distanceFalloff = 1.0 / max( pow( lightDistance, decay), 0.01 );\n    \n    if( cutoffDistance > 0.0 ) {\n        distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n    }\n\n    return distanceFalloff;\n}\n\n\nLight getPointLight(Fragment fragment, vec3 lightPosition, vec3 color, float intensity, float range) {\n\n    vec3 N = fragment.normal;\n    vec3 V = fragment.vectorToCamera;\n    float NdotV = fragment.NdotV;\n\n    vec3 L = normalize(lightPosition - v_Position);   // Light Direction \n    vec3 H = normalize(L+V);                          // Half vector between both l and v\n\n    float NdotL = saturate(dot(N, L));\n    float NdotH = saturate(dot(N, H));\n    float LdotH = saturate(dot(L, H));\n    float VdotH = saturate(dot(V, H));\n\n    float distance    = length(lightPosition - v_Position);\n    float attenuation = getFalloff(distance, range, 2.0); \n     \n    Light light = Light(\n        NdotL,\n        NdotH,\n        LdotH,\n        VdotH,\n        color,\n        attenuation,\n        intensity\n    );\n\n    return light;\n}\n\nLight getDirectionalLight(Fragment fragment, vec3 lightDirection, vec3 color, float intensity) {\n    vec3 N = fragment.normal;\n    vec3 V = fragment.vectorToCamera;\n    float NdotV = fragment.NdotV;\n\n    vec3 L = -normalize(lightDirection);   // Light Direction\n    vec3 H = normalize(L+V);                          // Half vector between both l and v\n\n    float NdotL = clamp(dot(N, L), 0.001, 1.0);\n    float NdotH = clamp(dot(N, H), 0.0, 1.0);\n    float LdotH = clamp(dot(L, H), 0.0, 1.0);\n    float VdotH = clamp(dot(V, H), 0.0, 1.0);\n\n    return Light(\n        NdotL,\n        NdotH,\n        LdotH,\n        VdotH,\n        color,\n        1.0,\n        intensity\n    );\n}\n\n//Spot light\nLight getSpotLight(Fragment fragment, vec3 lightPosition, vec3 lightDirection, float lightAngleScale, float lightAngleOffset, vec3 color, float intensity, float range) {\n\n    vec3 N = fragment.normal;\n    vec3 V = fragment.vectorToCamera;\n    float NdotV = fragment.NdotV;\n\n    vec3 L = normalize(lightPosition - v_Position);   // Light Direction \n    vec3 H = normalize(L+V);                          // Half vector between both l and v\n\n    float NdotL = saturate(dot(N, L));\n    float NdotH = saturate(dot(N, H));\n    float LdotH = saturate(dot(L, H));\n    float VdotH = saturate(dot(V, H));\n\n    float distance    = length(lightPosition - v_Position);\n    float attenuation = getFalloff(distance, range, 2.0); \n\n    float cd = dot(lightDirection, V);\n    float coneAttenuation = saturate(cd * lightAngleScale + lightAngleOffset);\n    attenuation = (coneAttenuation * coneAttenuation);\n\n    Light light = Light(\n        NdotL,\n        NdotH,\n        LdotH,\n        VdotH,\n        color,\n        attenuation,\n        intensity\n    );\n\n    return light;\n}\n\n\n// Basic Lambertian diffuse\n// Implementation from Lambert\'s Photometria https://archive.org/details/lambertsphotome00lambgoog\n// See also [1], Equation 1\n//\nvec3 diffuse(Pbr pbr, Fragment fragment, Light light)\n{\n    return pbr.diffuseColor / PI;\n}\n\n// The following equation models the Fresnel reflectance term of the spec equation (aka F())\n// Implementation of fresnel from [4], Equation 15\nvec3 specularReflection(Pbr pbr, Fragment fragment, Light light)\n{\n    return pbr.reflectance0 + (pbr.reflectance90 - pbr.reflectance0) * pow(clamp(1.0 - light.VdotH, 0.0, 1.0), 5.0);\n}\n\n// This calculates the specular geometric attenuation (aka G()),\n// where rougher material will reflect less light back to the viewer.\n// This implementation is based on [1] Equation 4, and we adopt their modifications to\n// alphaRoughness as input as originally proposed in [2].\nfloat geometricOcclusion(Pbr pbr, Fragment fragment, Light light)\n{\n    float NdotL = light.NdotL;\n    float NdotV = fragment.NdotV;\n    float r = pbr.alphaRoughness;\n\n    float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));\n    float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));\n    return attenuationL * attenuationV;\n}\n\n// The following equation(s) model the distribution of microfacet normals across the area being drawn (aka D())\n// Implementation from "Average Irregularity Representation of a Roughened Surface for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz\n// Follows the distribution function recommended in the SIGGRAPH 2013 course notes from EPIC Games [1], Equation 3.\nfloat microfacetDistribution(Pbr pbr, Fragment fragment, Light light)\n{\n    float roughnessSq = pbr.alphaRoughness * pbr.alphaRoughness;\n    float f = (light.NdotH * roughnessSq - light.NdotH) * light.NdotH + 1.0;\n    return roughnessSq / (PI * f * f);\n}\n\n//Get the light color using the above and inputs\nvec3 getLightColor(Pbr pbr, Fragment fragment, Light light) {\n    // Calculate the shading terms for the microfacet specular shading model\n    vec3 F = specularReflection(pbr, fragment, light);\n    float G = geometricOcclusion(pbr, fragment, light);\n    float D = microfacetDistribution(pbr, fragment, light);\n\n    // Calculation of analytical lighting contribution\n    vec3 diffuseAmt = diffuse(pbr, fragment, light);\n    vec3 specAmt = F * (G * D);\n\n    vec3 diffuseContrib = (1.0 - F) * diffuseAmt; \n    vec3 specContrib = specAmt / (4.0 * light.NdotL * fragment.NdotV);\n\n    // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)\n    //vec3 color = light.NdotL * light.color * light.falloff * light.intensity * (diffuseContrib + specContrib);\n    vec3 color = light.NdotL * light.color * light.falloff * light.intensity * (diffuseContrib + specContrib);\n    //color = color + (light.color * light.falloff * light.intensity * specContrib);\n\n\n    return color;\n}\n\n\n#endif\n',Aa="\n#ifdef USE_IBL\nuniform samplerCube u_DiffuseEnvSampler;\nuniform samplerCube u_SpecularEnvSampler;\nuniform sampler2D u_brdfLUT;\n\nvec3 getIBLContribution(Pbr pbr, Fragment fragment)\n{\n    float mipCount = 9.0; // resolution of 512x512\n    float lod = (pbr.perceptualRoughness * mipCount);\n    // retrieve a scale and bias to F0. See [1], Figure 3\n    \n    vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT, vec2(fragment.NdotV, 1.0 - pbr.perceptualRoughness))).rgb;\n    vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, fragment.normal)).rgb;\n    \n\n    #ifdef USE_TEX_LOD\n    vec3 specularLight = SRGBtoLINEAR(textureCubeLodEXT(u_SpecularEnvSampler, fragment.reflection, lod)).rgb;\n    #else\n    vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, fragment.reflection)).rgb;\n    #endif\n\n    vec3 diffuse = diffuseLight * pbr.diffuseColor;\n    vec3 specular = specularLight * (pbr.specularColor * brdf.x + brdf.y);\n\n    return diffuse + specular;\n}\n#endif\n",Ra="void main()\n{\n    #ifdef UNLIT\n\n        gl_FragColor = getBaseColor();\n        return;\n    #endif\n\n    Pbr pbr = getPbr();\n    Fragment fragment = getFragment();\n\n    vec3 color = vec3(0.0, 0.0, 0.0);\n    #ifdef USE_PUNCTUAL_LIGHTS\n        Light light;\n        //Actual implementation will dynamically write the code here\n        %PUNCTUAL_LIGHTS_FUNCS%\n    #endif\n\n    #ifdef USE_IBL\n        // Calculate lighting contribution from image based lighting source (IBL)\n        color += getIBLContribution(pbr, fragment);\n    #endif\n\n    // Apply optional PBR terms for additional (optional) shading\n    #ifdef HAS_OCCLUSIONMAP\n    float ao = texture2D(u_OcclusionSampler, v_UV).r;\n    color = mix(color, color * ao, u_OcclusionStrength);\n    #endif\n\n    #ifdef HAS_EMISSIVEMAP\n    vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, v_UV)).rgb * u_EmissiveFactor;\n    color += emissive;\n    #endif\n\n    gl_FragColor = vec4(pow(color,vec3(1.0/2.2)), pbr.baseColor.a);\n}\n";const Ma=({renderer:e,data:t})=>n=>{const r=(e=>t=>{if(sa.fill(0),ua.fill(0),ca.fill(0),la.fill(0),t.hasNormalAttributes&&(sa[0]=1),t.hasTangentAttributes&&(sa[1]=1),t.hasUvAttributes&&(sa[2]=1),t.hasColorAttributes&&(sa[3]=1),t.hasBaseColorMap&&(sa[4]=1),t.hasNormalMap&&(sa[5]=1),t.hasEmissiveMap&&(sa[6]=1),t.hasMetalRoughnessMap&&(sa[7]=1),t.hasOcclusionMap&&(sa[8]=1),t.manualSRGB&&(sa[9]=1),t.fastSRGB&&(sa[10]=1),t.unlit&&(sa[11]=1),sa[12]=t.alphaMode===lr.BLEND?0:1,sa[13]=t.alphaMode===lr.MASK?0:1,sa[14]=t.alphaMode===lr.OPAQUE?0:1,e.ibl&&(sa[15]=1,e.ibl.useLod&&(sa[16]=1)),e.unlit&&(sa[17]=1),e.lights){sa[18]=1;for(let t=0;t<e.lights.nDirectionalLights;t++)la[t]=1;for(let t=0;t<e.lights.nPointLights;t++)la[10+t]=1;for(let t=0;t<e.lights.nSpotLights;t++)la[20+t]=1}for(let e=0;e<t.nPositionMorphs;e++);for(let e=0;e<t.nNormalMorphs;e++);for(let e=0;e<t.nTangentMorphs;e++);for(let e=0;e<t.nMorphWeights;e++);for(let e=0;e<t.nSkinJoints;e++)ca[e]=1;const n=fa(sa).toString();return fa(ua).toString(),fa(ca).toString(),fa(la).toString(),n})(n.shaderConfig);return o=>{const a=r(o.shaderConfig);if(!t.shaders.has(a)){const r=pa(t)(n.shaderConfig)(o.shaderConfig),i=ia({shaderId:Symbol(),renderer:e,source:r});t.shaders.set(a,i),console.log("new shader compiled",a)}return t.shaders.get(a)}},pa=e=>t=>n=>Fo.map(e=>e.getShaderSource).reduce((r,o)=>(r=o(e)(t)(n)(r),r),Sa(e)(t)(n)),Sa=e=>t=>n=>{e.original;const r=[];switch(n.hasNormalAttributes&&r.push("HAS_NORMALS"),n.hasTangentAttributes&&r.push("HAS_TANGENTS"),n.hasUvAttributes&&r.push("HAS_UV"),n.hasColorAttributes&&r.push("HAS_COLOR"),n.hasBaseColorMap&&r.push("HAS_BASECOLORMAP"),n.hasNormalMap&&r.push("HAS_NORMALMAP"),n.hasEmissiveMap&&r.push("HAS_EMISSIVEMAP"),n.hasMetalRoughnessMap&&r.push("HAS_METALROUGHNESSMAP"),n.hasOcclusionMap&&r.push("HAS_OCCLUSIONMAP"),n.manualSRGB&&r.push("MANUAL_SRGB"),n.fastSRGB&&r.push("SRGB_FAST_APPROXIMATION"),n.nSkinJoints&&r.push("HAS_SKIN"),n.alphaMode){case lr.MASK:r.push("HAS_ALPHA_CUTOFF");break;case lr.BLEND:r.push("HAS_ALPHA_BLEND")}const o=r.map(e=>`#define ${e} 1\n`).join(""),a=o+[_a,Ea,da].join("\n"),i=o+[ha,Ea,Ta,ga,ma,Aa,Ra].join("\n");return{vertex:va(e)(t)(n)(a),fragment:i}},va=e=>e=>e=>t=>{let n="",r="",o=0,a=0;const i=e=>t=>{for(let i=0;i<e;i++){const e=`a_Morph_${o}`;n+=`attribute vec4 ${e};\n`,r+=`${t} += (u_MorphWeights[${a}] * ${e});\n`,o++}a++};e.nPositionMorphs&&i(e.nPositionMorphs)("m_Position"),e.nNormalMorphs&&i(e.nPositionMorphs)("m_Normal"),e.nTangentMorphs&&i(e.nPositionMorphs)("m_Tangent"),a&&(n+=`uniform float u_MorphWeights[${a}];\n`);let s="";return e.nSkinJoints&&(s=e.nSkinJoints.toString()),t.replace("%MORPH_VARS%",n).replace("%MORPH_FUNCS%",r).replace("%SKIN_JOINT_COUNT%",s)},Na=new Float64Array(3),Ia={directional:[void 0],point:[void 0],spot:[void 0]};for(let e=1;e<10;e++)Ia.directional.push({direction:new Float32Array(3*e),color:new Float32Array(3*e),intensity:new Float32Array(e)}),Ia.point.push({position:new Float32Array(3*e),color:new Float32Array(3*e),intensity:new Float32Array(e),range:new Float32Array(e)}),Ia.spot.push({position:new Float32Array(3*e),direction:new Float32Array(3*e),color:new Float32Array(3*e),intensity:new Float32Array(e),angleScale:new Float32Array(e),angleOffset:new Float32Array(e),range:new Float32Array(e)});const La=e=>t=>n=>{const o=new Map,a=new Map,i=new Array,s=n.shaderConfig.lights?(e=>{const t={directional:Ia.directional[e.shaderConfig.lights.nDirectionalLights],point:Ia.point[e.shaderConfig.lights.nPointLights],spot:Ia.spot[e.shaderConfig.lights.nSpotLights]};return t.directional&&(t.directional.offset=0),t.point&&(t.point.offset=0),t.spot&&(t.spot.offset=0),t})(n):void 0;Gr(e=>{if(e.kind!==fr.MESH||!e.transform||!e.transform.modelViewProjectionMatrix){if(e.kind===pr.LIGHT){const t=e.light,n=(()=>{switch(t.kind){case Sr.Directional:return s.directional;case Sr.Point:return s.point;case Sr.Spot:return s.spot}})(),o=t.color,a=t.intensity,i=t.kind===Sr.Point||t.kind===Sr.Spot?r.getTranslation(Na,e.transform.modelMatrix):void 0,u=t.direction;for(let e=0;e<3;e++){const t=3*n.offset+e;void 0!==i&&(n.position[t]=i[e]),void 0!==u&&(n.direction[t]=u[e]),n.color[t]=o[e]}t.kind===Sr.Spot&&(n.angleScale[n.offset]=t.angleScale,n.angleOffset[n.offset]=t.angleOffset),t.kind!==Sr.Point&&t.kind!==Sr.Spot||(n.range[n.offset]=t.range),n.intensity[n.offset]=a,n.offset++}}else i.push(e)})(n.nodes),i.forEach(r=>{let i;void 0!==r.skin&&r.skin.skinMatrices&&(i=r.skin.skinMatrices),r.primitives.forEach(u=>{const c=Ma({renderer:e,data:t})(n)(u);a.has(c.shaderId)||a.set(c.shaderId,[]);const l=a.get(c.shaderId);l.push((e=>()=>{const{renderer:t,data:n,node:r,primitive:o,lightList:a,scene:i,shader:s,skinMatrices:u}=e,{camera:c}=i,{gl:l}=t,f=n.original,{material:E,drawMode:d}=o,{uniforms:_,shaderId:h}=s,{uniform1i:T,uniform1f:g,uniform1fv:m,uniform1iv:A,uniform2fv:R,uniform3fv:M,uniform4fv:p,uniformMatrix4fv:S}=_.setters,v=n.attributes.vaoIdLookup.get(o.vaoId);let N=0;aa(h),E&&E.doubleSided?t.glToggle(vr.CULL_FACE)(!1):t.glToggle(vr.CULL_FACE)(!0),i.shaderConfig.ibl&&(t.switchTexture(N)(n.extensions.ibl.brdf),T("u_brdfLUT")(N++),n.extensions.ibl.cubeMaps.diffuse&&(t.switchCubeTexture(N)(n.extensions.ibl.cubeMaps.diffuse),T("u_DiffuseEnvSampler")(N++)),n.extensions.ibl.cubeMaps.specular&&(t.switchCubeTexture(N)(n.extensions.ibl.cubeMaps.specular),T("u_SpecularEnvSampler")(N++)),M("u_Camera")(c.position)),a&&(a.directional&&(M("u_Light_Directional_Direction")(a.directional.direction),M("u_Light_Directional_Color")(a.directional.color),m("u_Light_Directional_Intensity")(a.directional.intensity)),a.point&&(M("u_Light_Point_Position")(a.point.position),M("u_Light_Point_Color")(a.point.color),m("u_Light_Point_Intensity")(a.point.intensity),m("u_Light_Point_Range")(a.point.range)),a.spot&&(M("u_Light_Spot_Position")(a.spot.position),M("u_Light_Spot_Direction")(a.spot.direction),m("u_Light_Spot_AngleScale")(a.spot.angleScale),m("u_Light_Spot_AngleOffset")(a.spot.angleOffset),M("u_Light_Spot_Color")(a.spot.color),m("u_Light_Spot_Intensity")(a.spot.intensity),m("u_Light_Spot_Range")(a.spot.range))),u&&S("u_Skin_Matrices")(!1)(u),S("u_MVPMatrix")(!1)(r.transform.modelViewProjectionMatrix),S("u_ModelMatrix")(!1)(r.transform.modelMatrix),r.transform.normalMatrix&&S("u_NormalMatrix")(!1)(r.transform.normalMatrix),r.morphWeights&&m("u_MorphWeights")(r.morphWeights);const I=e=>r=>{"number"==typeof r?t.switchTexture(N)(n.textures.get(r)):t.switchTexture(N)(r),T(e)(N++)};if(E&&(R("u_MetallicRoughnessValues")(E.metallicRoughnessValues),p("u_BaseColorFactor")(E.baseColorFactor),void 0!==E.baseColorSamplerIndex&&I("u_BaseColorSampler")(E.baseColorSamplerIndex),void 0!==E.metallicRoughnessSamplerIndex&&I("u_MetallicRoughnessSampler")(E.metallicRoughnessSamplerIndex),void 0!==E.normal&&(g("u_NormalScale")(E.normal.scale),I("u_NormalSampler")(E.normal.samplerIndex)),void 0!==E.occlusion&&(g("u_OcclusionStrength")(E.occlusion.strength),I("u_OcclusionSampler")(E.occlusion.samplerIndex)),void 0!==E.emissiveSamplerIndex&&I("u_EmissiveSampler")(E.emissiveSamplerIndex),void 0!==E.emissiveFactor&&M("u_EmissiveFactor")(E.emissiveFactor),E.alphaMode===lr.MASK)){const e=E.alphaMode===lr.MASK?E.alphaCutoff:1;g("u_AlphaCutoff")(e)}if(t.vertexArrays.activate(v),o.drawKind===Er.ELEMENTS){const e=f.accessors[o.elementsId];l.drawElements(d,e.count,e.componentType,e.byteOffset||0)}else l.drawArrays(d,0,o.arrayCount)})({skinMatrices:i,renderer:e,data:t,node:r,primitive:u,lightList:s,scene:n,shader:c})),o.has(u.shaderConfig.alphaMode)||o.set(u.shaderConfig.alphaMode,new Set),o.get(u.shaderConfig.alphaMode).add(l)})}),e.glToggle(vr.BLEND)(!1),e.glToggle(vr.DEPTH_TEST)(!0),e.glDepthFunc(e.gl.LEQUAL),e.glBlendFunc(e.gl.SRC_ALPHA)(e.gl.ONE_MINUS_SRC_ALPHA);const u=ba(e)(o);u(lr.OPAQUE),u(lr.MASK),u(lr.BLEND)},ba=e=>t=>n=>{t.has(n)&&(n===lr.BLEND&&e.glToggle(vr.BLEND)(!0),t.get(n).forEach(e=>{e.forEach(e=>e())}))},Ca=e=>t=>{const n=zr(e)(null)(t);return Kr(Oa(n))(n)},Oa=e=>t=>{if(t.kind===fr.MESH&&t.skin){const n=Pa(e)(t),o=t=>{const r=n.find(e=>e.originalNodeId===t);return r?r.transform:(e=>t=>jr(t=>t.originalNodeId===e)(t))(t)(e).transform};let a=0;const i=r.invert(r.create(),void 0===t.skin.skeletonRootId?t.transform.modelMatrix:o(t.skin.skeletonRootId).modelMatrix),s=n.reduce((e,t)=>{const n=r.create();r.multiply(n,t.transform.modelMatrix,t.inverseBindMatrix),i&&r.multiply(n,i,n);for(let t=0;t<n.length;t++)e[a++]=n[t];return e},new Float32Array(16*t.skin.joints.length));return Object.assign({},t,{skin:Object.assign({},t.skin,{skinMatrices:s})})}return t},Pa=e=>t=>{const n=new Map,r=t.skin.joints.map((e,t)=>(n.set(e.originalNodeId,t),{originalNodeId:e.originalNodeId,inverseBindMatrix:e.inverseBindMatrix}));return kr(e=>{if(n.has(e.originalNodeId)){const t=n.get(e.originalNodeId);if(r[t].transform=e.transform,n.delete(e.originalNodeId),!n.size)return!0}return!1})(e),r},Ua=e=>(e=(e=>{const t=Fo.map(e=>e.runtimeShaderConfig_Scene).reduce((t,n)=>(t=n(e)(t),t),e.shaderConfig);return Object.assign({},e,{shaderConfig:t})})(e),e=Object.assign({},e,{nodes:Kr(t=>t.kind===fr.MESH?Object.assign({},t,{primitives:t.primitives.map(t=>(e=>t=>{const n=Fo.map(e=>e.runtimeShaderConfig_Primitive).reduce((n,r)=>(n=r(e)(t)(n),n),t.shaderConfig);return Object.assign({},t,{shaderConfig:n})})(e)(t))}):t)(e.nodes)})),Fa=({renderer:e,path:t,config:n,mapper:r})=>{const o=function(e){const t={};let n,r;const o=t=>n=>{const r=jr(e=>e.kind===pr.CAMERA&&e.cameraIndex===n)(t);if(!r)return;const o=Hr(r)(e.canvas);return Object.assign({},r,{camera:o})},a={renderer:e,getAllNodes:()=>n,getData:()=>r,getOriginalScene:t=>a=>{const i=Zo({renderer:e,data:r,allNodes:n})(a);let s=zr({updateLocal:!0,updateModel:!0,updateView:!1,updateLightDirection:!0})(null)(i.nodes);if(null==t){const e=o(s)(0);t=e.camera}return s=Ca({updateLocal:!1,updateModel:!1,updateView:!0,updateLightDirection:!1,camera:t})(i.nodes),Ua(Object.assign({},i,{nodes:s,camera:t}))},getCameraNode:o,loadFile:e=>Ro(e).then(Wo),loadAssets:({gltf:e,basePath:t,glbBuffers:n})=>xo({basePath:t||"",gltf:e,glbBuffers:n}),start:({gltf:t,assets:o,config:a})=>{const i=wo({gltf:t,renderer:e,assets:o,config:void 0===a?Eo():a}),s=$o({renderer:e,data:i});r=i,n=Jo({gltf:t,primitives:s,data:i,assets:o})},renderScene:t=>{La(e)(r)(t)}};return Object.assign(t,a),t}(e);return o.loadFile(t).then(({gltf:e,glbBuffers:a})=>(e=r?r(e):e,o.loadAssets({gltf:e,glbBuffers:a,basePath:Ao(t)}).then(t=>({gltf:e,config:n,assets:t})))).then(o.start).then(()=>o)};const ya=({getExtension:e,gl:t,version:n,buffers:r})=>{const o=new Map;let a;const i=r=>1===n?e("OES_vertex_array_object").bindVertexArrayOES(r):t.bindVertexArray(r),s=r=>s=>{(r||a!==s)&&(a=s,o.has(s)||o.set(s,(()=>1===n?e("OES_vertex_array_object").createVertexArrayOES():t.createVertexArray())()),i(o.get(s)))},u=()=>{null!==a&&(a=null,i(null))};return{activate:s(!1),release:u,assign:e=>n=>{s(!0)(e),n.elementBufferId&&r.bind(n.elementBufferId),n.data.forEach(({location:e,usagePattern:n,bufferId:o,size:a,type:i,normalized:s,stride:u,offset:c})=>{r.get(o),r.bind(o),t.vertexAttribPointer(e,a,i,void 0!==s&&s,void 0===u?0:u,void 0===c?0:c),t.enableVertexAttribArray(e)}),u()}}},xa=e=>{switch(e){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return!0}return!1},wa=e=>{const t=(e=>e.getParameter(vr.VERSION))(e);let n="";for(let e=0;e<t.length;e++){const r=t.charAt(e);if(xa(r))n+=r;else if(n.length)break}return parseInt(n,10)},Ba=e=>{const{canvas:t,contextAttributes:n}=e,r=(()=>{if(void 0!==e.gl)return e.gl;let r;if(void 0===e.version||2===e.version){try{r=t.getContext("webgl2",n)}catch(e){r=void 0}if(r)return r;console.warn("Failed to initialize webgl2, trying webgl1 as a fallback...")}try{r=t.getContext("webgl",n)||t.getContext("experimental-webgl",n)}catch(e){r=void 0}return r||console.warn("Unable to initialize webgl1"),r})(),o=wa(r),a={width:NaN,height:NaN},i=new Map,s=(e=>{const t=new Map,n=n=>{const r=t.get(n);e.bindBuffer(r.target,r.buffer)};return{assign:r=>o=>{const a=t.has(r)?t.get(r):{buffer:e.createBuffer()};a.data=o.data,a.target=o.target,a.usagePattern=o.usagePattern,t.set(r,a),n(r),e.bufferData(a.target,a.data,a.usagePattern)},get:e=>t.get(e),bind:n}})(r),u=new Map,c=e=>{if(!u.has(e)){const t=r.getExtension(e);t||console.warn("Could not create extension",e),u.set(e,t)}return u.get(e)};let l;let f,E;const d=(e=>{const t=new Map,n=n=>r=>o=>(t.has(r)&&(()=>{const e=t.get(r);return e.target===n&&e.texture===o})()||(e.activeTexture(e.TEXTURE0+r),e.bindTexture(n,o),t.set(r,{target:n,texture:o})),o);return{switchTexture:n(vr.TEXTURE_2D),switchCubeTexture:n(vr.TEXTURE_CUBE_MAP)}})(r),_=(({gl:e,buffers:t})=>{let n,r;const o=new Set,a=new Map,i=new Map,s=o=>{const a=t.get(o);n===o&&r===a.target||(e.bindBuffer(a.target,a.buffer),n=o,r=a.target)};return{globalLocations:o,getLocationInShader:t=>n=>{a.has(t)||a.set(t,new Map);const r=a.get(t);return r.has(n)||r.set(n,e.getAttribLocation(t,n)),r.get(n)},getLocationInRenderer:e=>{if(!i.has(e)){let e=0;o.forEach(t=>{i.has(t)||i.set(t,e),e++})}return i.get(e)},activateElements:s,activateData:t=>n=>r=>{s(n),e.vertexAttribPointer(t,r.size,r.type,void 0!==r.normalized&&r.normalized,void 0===r.stride?0:r.stride,void 0===r.offset?0:r.offset),e.enableVertexAttribArray(t)}}})({gl:r,buffers:s}),h=ya({getExtension:c,gl:r,version:o,buffers:s});return Object.assign({resize:({width:e,height:n})=>{a.width===e&&a.height===n||(t.setAttribute("width",e.toString()),t.setAttribute("height",n.toString()),r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),a.width=e,a.height=n)},canvas:t,gl:r,buffers:s,attributes:_,vertexArrays:h},d,{glToggle:e=>t=>{i.has(e)&&i.get(e)===t||(i.set(e,t),t?r.enable(e):r.disable(e))},glDepthFunc:e=>{e!==l&&(r.depthFunc(e),l=e)},glBlendFunc:e=>t=>{e===f&&t===E||(r.blendFunc(e,t),f=e,E=t)},getExtension:c,version:o,extras:{}})};var Da,Ha=function(){var e=document.getElementById("canvas"),t=Ba({canvas:e,version:1});t.gl.clearColor(0,0,0,0);var n=function(){return t.resize({width:window.innerWidth,height:window.innerHeight})};return n(),window.addEventListener("resize",n),t},Va=Symbol(),Ga=function(e){var t=Symbol(),n=e.gl,o=e.buffers;e.attributes.globalLocations.add("a_Position"),e.attributes.globalLocations.add("a_Color");var a=ia({renderer:e,shaderId:t,source:{vertex:"attribute vec3 a_Position;\nattribute vec3 a_Color;\n\nuniform mat4 u_Transform;\n\nvarying vec4 v_Color;\n\nvoid main() {\n    \n    gl_Position = u_Transform * (vec4(a_Position, 1));\n\n    v_Color = vec4(a_Color, 1); \n}\n",fragment:"precision mediump float;\n\nvarying vec4 v_Color;\n\nvoid main() {\n    gl_FragColor = v_Color;\n}\n"}}).uniforms.setters,i=(a.uniform1i,a.uniform1f,a.uniform2fv,a.uniform3fv,a.uniform4fv,a.uniformMatrix4fv);aa(t);return function(a){return function(s){aa(t);var u=r.multiply(r.create(),a.projection,a.view);i("u_Transform")(!1)(u),function(t){var r=new Float32Array(12*t.length);t.forEach(function(e,t){var n=12*t;r[n]=e.p1[0],r[n+1]=e.p1[1],r[n+2]=e.p1[2],r[n+3]=e.color[0],r[n+4]=e.color[1],r[n+5]=e.color[2],r[n+6]=e.p2[0],r[n+7]=e.p2[1],r[n+8]=e.p2[2],r[n+9]=e.color[0],r[n+10]=e.color[1],r[n+11]=e.color[2]});var a=r.BYTES_PER_ELEMENT,i=6*a;o.assign(Va)({target:vr.ARRAY_BUFFER,usagePattern:vr.STATIC_DRAW,data:r}),e.vertexArrays.release(),e.attributes.activateData(e.attributes.getLocationInRenderer("a_Position"))(Va)({size:3,stride:i,type:n.FLOAT}),e.attributes.activateData(e.attributes.getLocationInRenderer("a_Color"))(Va)({size:3,stride:i,offset:3*a,type:n.FLOAT})}(s),n.drawArrays(n.LINES,0,2*s.length)}}},Xa=function(e){return function(e){var t=e.getOriginalScene(null)(0);t=(e=>Ua(Object.assign({},e,{nodes:Ca({updateLocal:!0,updateModel:!0,updateView:!0,updateLightDirection:!0,camera:e.camera})(e.nodes)})))(ka(t));var n=(e=>t=>n=>Ua(Object.assign({},n,{nodes:Ca({updateLocal:!0,updateModel:!0,updateView:!0,updateLightDirection:!0,camera:n.camera})(e(t)(n.nodes))})))((e=>({loop:t})=>{const n=new Map;let r;return e.forEach((e,t)=>n.set(t,0)),o=>a=>{const i=void 0===r?0:(o-r)/1e3;return r=o,e.forEach((e,r)=>{let o=n.get(r)+i;if(!0===t)for(;o>e.timeMax;)o-=e.timeMax;o>=e.timeMin&&o<=e.timeMax&&(a=Kr(t=>t.animationIds&&-1!==t.animationIds.indexOf(r)?so(e)(o)(t):t)(a)),n.set(r,o)}),a}})(e.getData().animations)({loop:!0}));return{render:function(r){t=n(r)(t),e.renderScene(t)},getCamera:function(){return t.camera},setCamera:function(e){t.camera.view=e},setTranslationRotation:function(e){e.translation,e.rotation}}}},ka=function(e){var t,n,r;return Object.assign({},e,{nodes:e.nodes.concat([(t={intensity:3},n=t.intensity,r=t.rotation,{kind:pr.LIGHT,light:{kind:Sr.Directional,color:[1,1,1],intensity:n},transform:Cr(null)({rotation:r})}),function(e){var t=e.intensity,n=e.translation;return{kind:pr.LIGHT,light:{kind:Sr.Point,color:[1,1,1],intensity:t},transform:Cr(null)({translation:n})}}({intensity:10,translation:[-1,1,1]})])})};!function(e){e.IMMEDIATE="immediate",e.MICROTASK="microtask",e.NEXTFRAME="nextFrame"}(Da||(Da={}));var Wa;!function(e){e[e.PRESS=1]="PRESS",e[e.RELEASE=2]="RELEASE"}(Wa||(Wa={}));var ja;!function(e){e[e.START=1]="START",e[e.MOVE=2]="MOVE",e[e.END=3]="END",e[e.UNKNOWN=4]="UNKNOWN"}(ja||(ja={}));var Ya=function(e){switch(e.status){case ja.START:return e.hasPointer?["pointerdown"]:["mousedown","touchstart"];case ja.MOVE:return e.hasPointer?["pointermove"]:["mousemove","touchmove"];case ja.END:return e.hasPointer?["pointerup"]:["mouseup","touchend"]}return[]},qa=function(e){return void 0===e&&(e={}),void 0===e.hasPointer&&(e.hasPointer=!!window.PointerEvent),e},Ka=function(e){var t,n=!0===e.autoFlipY?(t=e.domElement,function(e){var n=t.getBoundingClientRect();return{x:e.x,y:n.height-e.y}}):function(e){return e};return function(t){var r=n(function(e){return function(e){return"touches"in e}(e)?e.touches.length?{x:e.touches[0].clientX,y:e.touches[0].clientY}:{x:NaN,y:NaN}:{x:e.clientX,y:e.clientY}}(t)),o=r.x,a=r.y,i={status:e.status,x:o,y:a};return null==e.validate||e.validate(i)?i:null}},za=function(e){return function(t){var n=qa(e),r=function(e){var t=Ka(e);return function(n){var r=n.defaultPrevented?null:t(n);return n.preventDefault(),null===r?null:{sourceId:"pointer",schedule:e.schedule,data:r,ts:n.timeStamp}}}(n),o=function(e){var n=r(e);null!==n&&t(n)},a=Ya(n);return a.forEach(function(e){n.domElement.addEventListener(e,o,!1)}),function(){a.forEach(function(e){n.domElement.removeEventListener(e,o,!1)})}}},$a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Za=function(e){return function(t){var n,r=null,o=qa(e),a=Ka(o),i=function(e){if(null!==r){var s=a(r),u=void 0===n?0:(e-n)/1e3;n=e,r=null,null!==s&&t({sourceId:"tickPointer",schedule:o.schedule,data:$a({},s,{frameTs:e,dt:u})})}requestAnimationFrame(i)};requestAnimationFrame(i);var s=Ya(o),u=function(e){e.defaultPrevented||(r=e),e.preventDefault()};return s.forEach(function(e){o.domElement.addEventListener(e,u,!1)}),function(){s.forEach(function(e){o.domElement.removeEventListener(e,u,!1)})}}},Qa=document.getElementById("canvas"),Ja=function(e){var t=[],n=function(){console.log("STOPPING"),t.forEach(function(e){return e()})};return t.push(Za({domElement:Qa,hasPointer:!0,status:ja.MOVE})(function(t){return e(t.data)})),t.push(za({domElement:Qa,hasPointer:!0,status:ja.END})(function(e){n()})),n},ei=function(e){return{cameraMatrix:e.matFromArray(3,3,e.CV_64F,[966.3557171609066,0,206.79307818305685,0,966.3557171609066,293.70020600555273,0,0,1]),distCoeffs:e.matFromArray(5,1,e.CV_64F,[-.0015007354215536557,.9872238982580184,.01718845254240881,-.02680595882042461,-2.3313928379240205])}},ti=function(e){var t=new e.DetectorParameters;return t.adaptiveThreshWinSizeMin=23,t.adaptiveThreshWinSizeMax=23,t.adaptiveThreshWinSizeStep=10,t.adaptiveThreshConstant=7,t.minMarkerPerimeterRate=.1,t.maxMarkerPerimeterRate=4,t.polygonalApproxAccuracyRate=.03,t.minCornerDistanceRate=.05,t.minDistanceToBorder=3,t.minMarkerDistanceRate=.05,t.cornerRefinementMethod=e.CORNER_REFINE_NONE,t.cornerRefinementWinSize=5,t.cornerRefinementMaxIterations=30,t.cornerRefinementMinAccuracy=.1,t.markerBorderBits=1,t.perspectiveRemovePixelPerCell=2,t.perspectiveRemoveIgnoredMarginPerCell=.13,t.maxErroneousBitsInBorderRate=.35,t.minOtsuStdDev=5,t.errorCorrectionRate=.6,t},ni=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(i,s)}u((r=r.apply(e,t||[])).next())})},ri=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},oi=(Symbol("video"),Symbol("video"),function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(i,s)}u((r=r.apply(e,t||[])).next())})}),ai=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};function ii(e){return e}var si=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(i,s)}u((r=r.apply(e,t||[])).next())})},ui=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},ci={buildMode:"production",buildVersion:"0.0.1-alpha",isProduction:!0},li=ci.buildVersion,fi=ci.isProduction;console.log("%c Web Menorah "+li+" (productionMode: "+fi+")",'color: #4286f4; font-size: large; font-family: "Comic Sans MS", cursive, sans-serif');new Worker("./mainWorker.js");si(void 0,void 0,void 0,function(){var e,t,r,o,a,i,s,u,c,l;return ui(this,function(f){switch(f.label){case 0:return e=Ha(),[4,Fa({renderer:e,path:"static/models/day1/menorah.gltf"})];case 1:return t=f.sent(),[4,function(){return oi(this,void 0,void 0,function(){var e;return ai(this,function(t){switch(t.label){case 0:return e=ii,[4,n.e(1).then(n.bind(null,4))];case 1:return[2,e.apply(void 0,[t.sent()])]}})})}()];case 2:return r=f.sent(),[4,ni(void 0,void 0,void 0,function(){var e,t,n;return ri(this,function(r){switch(r.label){case 0:return(e=document.getElementById("video")).style.position="absolute",e.style.width="100vw",e.style.height="100vh",e.autoplay=!0,e.muted=!0,e.loop=!0,e.width=window.innerWidth,e.height=window.innerHeight,[4,navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment"}})];case 1:return t=r.sent(),n=new Promise(function(n){return e.addEventListener("playing",function(){n({stream:t})})}),e.srcObject=t,e.play(),[2,n]}})})];case 3:return o=f.sent(),Ga(e),a=function(e){var t=window.cv,n=document.createElement("canvas"),r=document.getElementById("video"),o=r.videoWidth,a=r.videoHeight;new ImageCapture(e.getVideoTracks()[0]),n.width=o,n.height=a,n.setAttribute("width",""+o),n.setAttribute("height",""+a),n.style.width=o+"px",n.style.height=a+"px";var i=n.getContext("2d"),s=new t.Mat(a,o,t.CV_8UC4),u=(new t.Mat,new t.Mat),c=new t.Mat,l=new t.MatVector,f=t.Mat.zeros(1,3,t.CV_64F),E=t.Mat.zeros(3,3,t.CV_64F),d=new t.Mat,_=new t.Dictionary(t.DICT_6X6_250),h=ti(t),T=ei(t),g=T.cameraMatrix,m=T.distCoeffs,A=t.matFromArray(4,4,t.CV_64F,[1,1,1,1,-1,-1,-1,-1,-1,-1,-1,-1,1,1,1,1]);return console.log(A.data64F),function(){return new Promise(function(e){i.drawImage(r,0,0);var n=i.getImageData(0,0,o,a).data;if(s.data.set(n),t.cvtColor(s,u,t.COLOR_RGBA2RGB,0),t.detectMarkers(u,_,l,c,h),c.rows>0){t.estimatePoseSingleMarkers(l,.1,g,m,f,d),t.Rodrigues(f,E);var T=d.data64F,R=E.data64F,M=t.matFromArray(4,4,t.CV_64F,[R[0],R[1],R[2],T[0],R[3],R[4],R[5],T[1],R[6],R[7],R[8],T[2],0,0,0,1]),p=t.Mat.zeros(4,4,t.CV_64F);t.multiply(A,M,p),t.transpose(p,p),e(p.data64F)}else e(!1)})}}(o.stream),i=Xa()(t),s=r.create_camera(e.canvas.clientWidth,e.canvas.clientHeight),i.setCamera(r.get_camera_view(s)),E=function(e){e[0],e[1]},d=new Float32Array(2),_=new Float32Array(2),Za({domElement:Qa,hasPointer:!0,status:ja.START})(function(e){d[0]=e.data.x,d[1]=e.data.y,Ja(function(e){_[0]=e.x,_[1]=e.y,E([d,_]),d[0]=e.x,d[1]=e.y})}),u=!1,c=!1,l=function(t){e.gl.clear(e.gl.COLOR_BUFFER_BIT|e.gl.DEPTH_BUFFER_BIT),c&&i.render(t),u||(u=!0,a().then(function(e){e&&(i.setCamera(e),c=!0),u=!1})),requestAnimationFrame(l)},requestAnimationFrame(l),[2]}var E,d,_})})}});